# Project Bedrock Environment Variables Template
# Copy this file to .env and fill in the values

# ============================================
# Database Configuration
# ============================================
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=bedrock
POSTGRES_PASSWORD=bedrock_password
POSTGRES_DB=bedrock_db
DATABASE_URL=postgresql://bedrock:bedrock_password@localhost:5432/bedrock_db

# ============================================
# Redis Configuration
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_URL=redis://localhost:6379/0

# ============================================
# Application Configuration
# ============================================
DEBUG=false
LOG_LEVEL=INFO
SECRET_KEY=change-this-to-a-strong-random-key-in-production

# ============================================
# External API Keys
# ============================================

# Binance API
# How to obtain: https://www.binance.com/en/my/settings/api-management
BINANCE_API_KEY=your_binance_api_key_here
BINANCE_API_SECRET=your_binance_api_secret_here

# Bitquery API
# How to obtain: https://bitquery.io/
BITQUERY_API_KEY=your_bitquery_api_key_here
BITQUERY_API_URL=https://graphql.bitquery.io

# Qwen LLM API
# How to obtain: https://dashscope.aliyun.com/
QWEN_API_KEY=your_qwen_api_key_here
QWEN_API_URL=https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation

# LLM Provider Selection (qwen/deepseek/openai/claude)
LLM_PROVIDER=qwen
LLM_ENABLED=true

# ============================================
# Service Ports
# ============================================
DATAHUB_PORT=8001
DECISION_ENGINE_PORT=8002
PORTFOLIO_PORT=8003
BACKTESTING_PORT=8004
MLOPS_PORT=8005
NOTIFICATION_PORT=8006
WEBAPP_PORT=3000

# ============================================
# DecisionEngine Service Configuration
# ============================================
# Signal generation interval in minutes (default: 60)
SIGNAL_GENERATION_INTERVAL_MINUTES=60

# DataHub Service base URL for fetching market data
DATAHUB_BASE_URL=http://localhost:8001

# Rule engine scoring thresholds
MIN_RULE_ENGINE_SCORE=60.0
HIGH_CONFIDENCE_THRESHOLD=85.0
MEDIUM_CONFIDENCE_THRESHOLD=70.0

# Position weight ranges based on confidence levels
HIGH_CONFIDENCE_WEIGHT_MIN=0.8
HIGH_CONFIDENCE_WEIGHT_MAX=1.0
MEDIUM_CONFIDENCE_WEIGHT_MIN=0.5
MEDIUM_CONFIDENCE_WEIGHT_MAX=0.7
LOW_CONFIDENCE_WEIGHT_MIN=0.3
LOW_CONFIDENCE_WEIGHT_MAX=0.5

# Trading symbols to monitor (comma-separated)
TRADING_SYMBOLS=BTCUSDT,ETHUSDT,BNBUSDT,SOLUSDT,ADAUSDT

# ============================================
# Funding Rate Strategy Configuration (Phase 2)
# ============================================
# Enable/disable funding rate strategy
FUNDING_RATE_ENABLED=false

# High funding rate threshold (0.1% = 0.001, triggers SHORT signal)
FUNDING_RATE_HIGH_THRESHOLD=0.001

# Low funding rate threshold (-0.1% = -0.001, triggers LONG signal)
FUNDING_RATE_LOW_THRESHOLD=-0.001

# Funding rate cache TTL in seconds (8 hours = 28800)
FUNDING_RATE_CACHE_TTL=28800

# ============================================
# ML Model Configuration (Phase 2)
# ============================================
# 模型开关
ML_ENABLED=true

# 模型版本（v1/v2_6/v2_7）
# - v1: 13个基础技术指标特征
# - v2_6: 19个多频特征（multifreq-full baseline）
# - v2_7: 30个特征（19个多频 + 11个跨币种特征）
ML_MODEL_VERSION=v1

# 模型文件路径
ML_MODEL_PATH=services/decision_engine/models/xgboost_signal_confidence_v1.pkl

# 特征名称文件路径
ML_FEATURE_NAMES_PATH=services/decision_engine/models/feature_names.json

# ML模型降级分数（当模型不可用时使用）
ML_FALLBACK_SCORE=50.0

# ============================================
# v2.7 Model Configuration Example (部署v2.7模型时取消注释)
# ============================================
# ML_MODEL_VERSION=v2_7
# ML_MODEL_PATH=services/decision_engine/models/xgboost_signal_confidence_v2_7_seed_5926.pkl
# ML_FEATURE_NAMES_PATH=services/decision_engine/models/feature_names_v2_7.json

# ============================================
# Portfolio Service Configuration
# ============================================
# Account initialization
INITIAL_BALANCE=100000.00
DEFAULT_ACCOUNT_ID=00000000-0000-0000-0000-000000000001

# Position sizing (方案A: Position Weight Strategy)
DEFAULT_RISK_PER_TRADE=0.02
MAX_POSITION_WEIGHT=1.0

# Trading costs
COMMISSION_RATE=0.001
SLIPPAGE_RATE=0.0005

# Auto-close feature (MVP: disabled)
ENABLE_AUTO_CLOSE=false

# Event channels
SIGNAL_CREATED_CHANNEL=signal.created
PORTFOLIO_UPDATED_CHANNEL=portfolio.updated
POSITION_CLOSED_CHANNEL=position.closed

# Event handling
EVENT_PUBLISH_MAX_RETRIES=3
EVENT_PUBLISH_RETRY_DELAY=1
EVENT_SUBSCRIBE_MAX_RETRIES=5
EVENT_SUBSCRIBE_RETRY_DELAY=5

# ============================================
# Celery Configuration
# ============================================
CELERY_BROKER_URL=redis://localhost:6379/0
CELERY_RESULT_BACKEND=redis://localhost:6379/0

# ============================================
# MLflow Configuration (Phase 3)
# ============================================
MLFLOW_TRACKING_URI=http://localhost:5000

# ============================================
# Environment-Specific Settings
# ============================================
# Uncomment for development
# DEBUG=true
# LOG_LEVEL=DEBUG

# Uncomment for production
# DEBUG=false
# LOG_LEVEL=WARNING

# ============================================
# 快速切换模型版本指南
# ============================================
#
# 切换到v1模型（13个基础特征）：
# ML_MODEL_VERSION=v1
# ML_MODEL_PATH=services/decision_engine/models/xgboost_signal_confidence_v1.pkl
# ML_FEATURE_NAMES_PATH=services/decision_engine/models/feature_names.json
#
# 切换到v2.7模型（30个特征，性能最优）：
# ML_MODEL_VERSION=v2_7
# ML_MODEL_PATH=services/decision_engine/models/xgboost_signal_confidence_v2_7_seed_5926.pkl
# ML_FEATURE_NAMES_PATH=services/decision_engine/models/feature_names_v2_7.json
#
# 修改后重启服务：
# docker-compose restart decision_engine
#
# 验证服务健康：
# curl http://localhost:8002/health
#
