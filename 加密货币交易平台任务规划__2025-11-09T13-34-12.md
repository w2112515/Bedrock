[ ] NAME:Current Task List DESCRIPTION:Root task for conversation __NEW_AGENT__
-[ ] NAME:Project Bedrock - AI增强型加密货币交易决策平台 DESCRIPTION:基于2.md v2.0计划书的完整实现路线图。目标：构建一个AI增强的、可自我优化的全链路交易研究与决策平台。技术栈：FastAPI + PostgreSQL + Redis + React + Docker + Kubernetes。严格遵循关注点分离、DDD、依赖注入等核心架构原则。
--[ ] NAME:Phase 0: 环境准备与项目初始化 (1-2周) DESCRIPTION:参考2.md第三部分Phase 0。目标：建立标准化的开发环境，配置代码质量工具，确保所有开发者在统一的环境中工作。关键交付物：标准化开发环境、自动化代码质量检查、完整项目文档框架、可运行的基础设施（PostgreSQL + Redis）。
---[ ] NAME:0.1 环境验证 DESCRIPTION:参考2.md Phase 0功能点1。验证Docker Desktop、Python 3.11+、Node.js 18+、Git安装情况，创建Python虚拟环境，安装全局依赖管理工具。
----[ ] NAME:0.1.1 验证Docker Desktop是否正在运行 DESCRIPTION:打开PowerShell，执行命令：docker --version 和 docker ps。验证Docker Desktop已安装且正在运行。如果未运行，请启动Docker Desktop应用程序。
----[ ] NAME:0.1.2 验证Python版本 DESCRIPTION:在PowerShell中执行：python --version。确认版本 >= 3.11。如果版本不符，请从 python.org 下载并安装Python 3.11或更高版本。
----[ ] NAME:0.1.3 验证Node.js版本 DESCRIPTION:在PowerShell中执行：node --version 和 npm --version。确认Node.js版本 >= 18。如果版本不符，请从 nodejs.org 下载并安装Node.js 18 LTS或更高版本。
----[ ] NAME:0.1.4 验证Git配置 DESCRIPTION:在PowerShell中执行：git --version。验证Git已安装。然后执行：git config --global user.name 和 git config --global user.email，确认已配置用户名和邮箱。如果未配置，请执行：git config --global user.name "Your Name" 和 git config --global user.email "your.email@example.com"。
----[ ] NAME:0.1.5 创建Python虚拟环境 DESCRIPTION:在项目根目录e:\projectBedrock中，打开PowerShell，执行：python -m venv .venv。这将在项目根目录创建一个名为.venv的虚拟环境文件夹。
----[ ] NAME:0.1.6 测试虚拟环境激活 DESCRIPTION:在PowerShell中执行：.venv\Scripts\Activate.ps1。如果出现执行策略错误，请以管理员身份运行PowerShell并执行：Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser。激活后，命令行前缀应显示(.venv)。执行python --version确认使用的是虚拟环境中的Python。
---[ ] NAME:0.2 项目初始化 DESCRIPTION:参考2.md Phase 0功能点2。初始化Git仓库，创建.gitignore，创建项目目录结构（services/, docs/, webapp/, scripts/），创建环境变量模板文件。
----[ ] NAME:0.2.1 初始化Git仓库 DESCRIPTION:在项目根目录e:\projectBedrock中，执行：git init。这将初始化一个新的Git仓库。
----[ ] NAME:0.2.2 创建.gitignore文件 DESCRIPTION:在项目根目录创建文件e:\projectBedrock\.gitignore。内容包括：.venv/, __pycache__/, *.pyc, .env, node_modules/, dist/, build/, .DS_Store, *.log, .pytest_cache/, .mypy_cache/, .coverage, htmlcov/。
----[ ] NAME:0.2.3 创建services/目录 DESCRIPTION:在项目根目录创建文件夹e:\projectBedrock\services。这个目录将存放所有后端微服务代码。
----[ ] NAME:0.2.4 创建docs/目录 DESCRIPTION:在项目根目录创建文件夹e:\projectBedrock\docs。这个目录将存放所有项目文档。
----[ ] NAME:0.2.5 创建webapp/目录 DESCRIPTION:在项目根目录创建文件夹e:\projectBedrock\webapp。这个目录将存放React前端应用代码。
----[ ] NAME:0.2.6 创建scripts/目录 DESCRIPTION:在项目根目录创建文件夹e:\projectBedrock\scripts。这个目录将存放各种辅助脚本（初始化、测试、部署等）。
----[ ] NAME:0.2.7 创建.env.example文件 DESCRIPTION:在项目根目录创建文件e:\projectBedrock\.env.example。参考2.md第四部分16环境变量命名规范。内容包括：POSTGRES_HOST=localhost, POSTGRES_PORT=5432, POSTGRES_DB=bedrock, POSTGRES_USER=postgres, POSTGRES_PASSWORD=your_password, REDIS_HOST=localhost, REDIS_PORT=6379, BINANCE_API_KEY=your_binance_key, BINANCE_API_SECRET=your_binance_secret, QWEN_API_KEY=your_qwen_key等。
----[ ] NAME:0.2.8 创建.env文件 DESCRIPTION:复制.env.example为.env：copy .env.example .env。然后编辑e:\projectBedrock\.env文件，填入真实的数据库密码、Binance API Key、Qwen API Key等敏感信息。注意：.env文件已在.gitignore中，不会被提交到Git。
---[ ] NAME:0.3 基础设施 DESCRIPTION:参考2.md Phase 0功能点3。创建根目录docker-compose.yml，定义PostgreSQL和Redis，配置healthcheck，启动基础设施服务并验证连接。
----[ ] NAME:0.3.1 创建docker-compose.yml文件 DESCRIPTION:在项目根目录创建文件e:\projectBedrock\docker-compose.yml。参考2.md第四部分14 Docker Compose健康检查配置。定义version: '3.8'，包含services: postgres, redis。
----[ ] NAME:0.3.2 配置PostgreSQL服务 DESCRIPTION:在docker-compose.yml中配置postgres服务。使用镜像：postgres:16-alpine。设置环境变量：POSTGRES_DB=bedrock, POSTGRES_USER=postgres, POSTGRES_PASSWORD=从docker-compose.yml中引用${POSTGRES_PASSWORD}。映射端口：5432:5432。挂载数据卷：postgres_data:/var/lib/postgresql/data。
----[ ] NAME:0.3.3 为PostgreSQL添加healthcheck DESCRIPTION:参考2.md第四部分14。在postgres服务中添加healthcheck配置：test: ["CMD-SHELL", "pg_isready -U postgres"], interval: 10s, timeout: 5s, retries: 5。
----[ ] NAME:0.3.4 配置Redis服务 DESCRIPTION:在docker-compose.yml中配置redis服务。使用镜像：redis:7-alpine。映射端口：6379:6379。挂载数据卷：redis_data:/data。
----[ ] NAME:0.3.5 为Redis添加healthcheck DESCRIPTION:参考2.md第四部分14。在redis服务中添加healthcheck配置：test: ["CMD", "redis-cli", "ping"], interval: 10s, timeout: 5s, retries: 5。
----[ ] NAME:0.3.6 定义volumes DESCRIPTION:在docker-compose.yml文件底部添加volumes定义：volumes: postgres_data:, redis_data:。这将创建Docker命名数据卷以持久化数据。
----[ ] NAME:0.3.7 启动基础设施服务 DESCRIPTION:在项目根目录执行：docker-compose up -d postgres redis。这将以后台模式启动PostgreSQL和Redis服务。
----[ ] NAME:0.3.8 验证PostgreSQL连接 DESCRIPTION:执行：docker-compose exec postgres psql -U postgres -d bedrock -c "SELECT version();"。如果成功返回PostgreSQL版本信息，说明数据库连接正常。
----[ ] NAME:0.3.9 验证Redis连接 DESCRIPTION:执行：docker-compose exec redis redis-cli ping。如果返回PONG，说明Redis连接正常。
----[ ] NAME:0.3.10 验证healthcheck状态 DESCRIPTION:执行：docker-compose ps。确认postgres和redis服务的State列显示为Up (healthy)。这证明健康检查配置正确且服务健康。
----[ ] NAME:0.3.11 创建集中式数据库迁移目录 DESCRIPTION:在项目根目录创建文件夹e:\projectBedrock\database_migrations。这个目录将集中管理所有服务的数据库迁移文件，避免多服务共享数据库时的迁移冲突。创建子目录：alembic/, alembic/versions/。
----[ ] NAME:0.3.12 配置集中式Alembic DESCRIPTION:在database_migrations/目录创建alembic.ini和alembic/env.py。配置sqlalchemy.url从环境变量读取。在env.py中导入所有服务的模型（from services.datahub.app.models import *, from services.decision_engine.app.models import *等），确保Alembic能检测到所有表变更。添加迁移命名规范：{timestamp}_{service_name}_{description}。
----[ ] NAME:0.3.13 创建数据库迁移协调文档 DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\DATABASE_MIGRATION_COORDINATION.md。记录集中式迁移策略：1)所有迁移必须在database_migrations/目录创建。2)迁移文件命名包含服务名（如20250109_datahub_add_klines_table.py）。3)每个服务的模型文件必须在database_migrations/alembic/env.py中导入。4)迁移执行命令：cd database_migrations && alembic upgrade head。5)表所有权规则：每张表只能由一个服务修改Schema，其他服务只读。6)冲突解决流程：如果多个服务需要修改同一张表，必须先在团队会议中讨论并更新表所有权文档。
---[ ] NAME:0.4 代码质量工具 DESCRIPTION:参考2.md Phase 0功能点4。配置pyproject.toml（black, isort, mypy, flake8），配置前端.eslintrc.json和.prettierrc，创建.editorconfig，安装和配置pre-commit hooks。
----[ ] NAME:0.4.1 创建pyproject.toml文件 DESCRIPTION:在项目根目录创建文件e:\projectBedrock\pyproject.toml。参考2.md第二部分2.2技术栈选型。定义[tool.black], [tool.isort], [tool.mypy], [tool.flake8]配置。
----[ ] NAME:0.4.2 安装Python代码质量工具 DESCRIPTION:激活虚拟环境后，执行：pip install black isort mypy flake8 pre-commit pytest pytest-cov。这将安装所有Python代码质量工具。
----[ ] NAME:0.4.3 创建.editorconfig文件 DESCRIPTION:在项目根目录创建文件e:\projectBedrock\.editorconfig。定义编辑器通用配置：root=true, indent_style=space, indent_size=4 (Python), indent_size=2 (JS/TS), charset=utf-8, end_of_line=lf, trim_trailing_whitespace=true。
----[ ] NAME:0.4.4 创建.pre-commit-config.yaml DESCRIPTION:在项目根目录创建文件e:\projectBedrock\.pre-commit-config.yaml。配置hooks：black, isort, flake8, mypy。参考pre-commit官方文档配置格式。
----[ ] NAME:0.4.5 安装pre-commit hooks DESCRIPTION:执行：pre-commit install。这将在.git/hooks/目录中安装pre-commit钩子，从而在每次git commit前自动运行代码质量检查。
----[ ] NAME:0.4.6 测试pre-commit自动运行 DESCRIPTION:创建一个测试文件test.py，执行git add test.py，然后执行git commit -m "test pre-commit"。验证pre-commit自动运行并检查代码格式。测试完成后可以执行git reset HEAD~撤销提交。
---[ ] NAME:0.5 文档 DESCRIPTION:参考2.md Phase 0功能点5。创建README.md、ARCHITECTURE.md、DATA_MODEL_AND_API_CONTRACT.md、DEVELOPER_GUIDE.md、ENVIRONMENT_VARIABLES.md、TECH_STACK_VERSIONS.md、DEPLOYMENT_ENVIRONMENTS.md、DATABASE_MIGRATION_GUIDE.md等文档。
----[ ] NAME:0.5.1 创建README.md DESCRIPTION:在项目根目录创建文件e:\projectBedrock\README.md。内容包括：项目简介、技术栈、快速开始（环境准备、启动服务）、项目结构、贡献指南。
----[ ] NAME:0.5.2 创建ARCHITECTURE.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\ARCHITECTURE.md。参考2.md第一部分1.2核心架构原则和第二部分2.1高阶系统架构图。详细描述系统架构、服务划分、交互流程、技术决策。
----[ ] NAME:0.5.3 创建DATA_MODEL_AND_API_CONTRACT.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\DATA_MODEL_AND_API_CONTRACT.md。参考2.md第四部分数据模型与接口契约。定义所有核心领域对象（Signal, Position, Trade等）的数据库Schema、事件契约、API契约。
----[ ] NAME:0.5.4 创建DEVELOPER_GUIDE.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\DEVELOPER_GUIDE.md。内容包括：开发环境搭建、代码规范、测试指南、调试技巧、常见问题解决。
----[ ] NAME:0.5.5 创建ENVIRONMENT_VARIABLES.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\ENVIRONMENT_VARIABLES.md。参考2.md第四部分16环境变量命名规范。详细记录所有环境变量的名称、类型、默认值、说明、示例。
----[ ] NAME:0.5.6 创建TECH_STACK_VERSIONS.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\TECH_STACK_VERSIONS.md。参考2.md第四部分17技术栈版本锁定。记录所有依赖的固定版本、选择理由、升级策略。
----[ ] NAME:0.5.7 创建DEPLOYMENT_ENVIRONMENTS.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\DEPLOYMENT_ENVIRONMENTS.md。参考2.md第四部分18环境配置差异管理。定义开发、测试、生产环境的配置差异和切换检查清单。
----[ ] NAME:0.5.8 创建DATABASE_MIGRATION_GUIDE.md DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\DATABASE_MIGRATION_GUIDE.md。参考2.md第四部分19数据库迁移最佳实践。记录数据库迁移流程、回滚策略、常见问题解决方案。
----[ ] NAME:0.5.9 创建文档维护清单 DESCRIPTION:在docs/目录创建文件e:\projectBedrock\docs\DOCUMENTATION_MAINTENANCE.md。内容包括：1)所有文档列表及其维护责任人。2)文档更新触发条件（如API变更必须更新DATA_MODEL_AND_API_CONTRACT.md，新增环境变量必须更新ENVIRONMENT_VARIABLES.md）。3)文档审查周期（每个Phase结束时审查一次）。4)文档完整性检查清单（每个API端点是否有文档、每个环境变量是否有说明、每个数据模型是否有Schema定义）。5)在CI/CD中添加文档完整性检查步骤（检查API文档与实际端点是否一致）。
---[ ] NAME:0.6 辅助脚本 DESCRIPTION:参考2.md Phase 0功能点6。创建init_db.py、init_account.py、test_all.sh、lint.sh、validate_env.py等辅助脚本。
----[ ] NAME:0.6.1 创建init_db.py脚本 DESCRIPTION:在scripts/目录创建文件e:\projectBedrock\scripts\init_db.py。这个脚本用于初始化数据库，创建所有表结构。使用SQLAlchemy连接数据库，读取环境变量中的数据库连接信息。
----[ ] NAME:0.6.2 创建init_account.py脚本 DESCRIPTION:在scripts/目录创建文件e:\projectBedrock\scripts\init_account.py。这个脚本用于初始化账户余额，在account表中插入默认账户记录（如balance=100000.00）。
----[ ] NAME:0.6.3 创建validate_env.py脚本（增强版） DESCRIPTION:在scripts/目录创建文件e:\projectBedrock\scripts\validate_env.py。参考2.md Phase 0功能点6。增强功能：1)验证所有必需环境变量是否已配置。2)类型验证：URL格式（POSTGRES_HOST, REDIS_HOST），整数（POSTGRES_PORT, REDIS_PORT），布尔值（DEBUG）。3)依赖检查：如果配置了QWEN_API_KEY，则QWEN_API_URL也必须配置；如果配置了BINANCE_API_KEY，则BINANCE_API_SECRET也必须配置。4)敏感信息检查：警告如果.env文件权限过于宽松（Windows上检查文件属性）。5)输出验证报告：列出所有已配置的环境变量、缺失的必需变量、格式错误的变量。6)在所有服务的启动脚本中自动调用此验证脚本。
----[ ] NAME:0.6.4 创建test_all.ps1脚本 DESCRIPTION:在scripts/目录创建文件e:\projectBedrock\scripts\test_all.ps1（PowerShell脚本）。这个脚本用于运行所有测试。内容：激活虚拟环境，运行pytest --cov。
----[ ] NAME:0.6.5 创建lint.ps1脚本 DESCRIPTION:在scripts/目录创建文件e:\projectBedrock\scripts\lint.ps1（PowerShell脚本）。这个脚本用于运行代码质量检查。内容：激活虚拟环境，运行black --check ., isort --check ., flake8 ., mypy .。
---[ ] NAME:0.7 首次提交 DESCRIPTION:参考2.md Phase 0功能点7。执行git add . 和 git commit，创建.github/workflows/目录为CI/CD做准备。
----[ ] NAME:0.7.1 添加所有文件到Git DESCRIPTION:在项目根目录执行：git add .。这将添加所有新创建的文件到Git暂存区。
----[ ] NAME:0.7.2 执行首次提交 DESCRIPTION:执行：git commit -m "Phase 0: Initial project setup - environment, infrastructure, docs, and tooling"。这将创建Phase 0的首次提交。
----[ ] NAME:0.7.3 创建.github/workflows/目录 DESCRIPTION:创建文件夹e:\projectBedrock\.github\workflows。这个目录将存放GitHub Actions的CI/CD配置文件，为Phase 3的CI/CD流水线做准备。
----[ ] NAME:0.7.4 创建.github/workflows/.gitkeep DESCRIPTION:在.github/workflows/目录创建一个空文件.gitkeep，以便将空目录提交到Git。
----[ ] NAME:0.7.5 提交.github目录 DESCRIPTION:执行：git add .github && git commit -m "Add .github/workflows directory for future CI/CD"。
---[ ] NAME:0.8 低优先级优化 DESCRIPTION:参考2.md Phase 0低优先级任务。包括API文档自动生成、开发环境热重载优化、数据库种子数据脚本、数据库性能监控。这些是可选的优化功能，可在核心功能完成后实施。
----[ ] NAME:0.8.1 配置API文档自动生成 DESCRIPTION:参考2.md第四部分33 API文档自动生成。在所有FastAPI服务中添加ReDoc端点：/redoc。使用openapi-generator-cli生成Markdown文档。生成的文档保存到docs/api/目录。添加API使用示例（curl命令、Python代码）。在README.md中添加API文档链接。验证：访问http://localhost:8001/redoc查看ReDoc文档。
----[ ] NAME:0.8.2 优化开发环境热重载 DESCRIPTION:参考2.md第四部分34开发环境热重载优化。在Dockerfile中使用uvicorn --reload --reload-dir /app。配置.dockerignore排除__pycache__, *.pyc, .pytest_cache, .mypy_cache。在docker-compose.yml中添加volumes挂载，但排除__pycache__。使用watchfiles库优化文件监控。在DEVELOPER_GUIDE.md中添加热重载使用说明。验证：修改代码后服务自动重启。
----[ ] NAME:0.8.3 创建数据库种子数据脚本 DESCRIPTION:参考2.md第四部分35数据库种子数据。创建scripts/seed_data.py脚本生成示例数据。生成20个示例信号、10个示例仓位、5个示例回测报告。生成1个默认账户（初始余额100000 USDT）。支持命令行参数：--clear（清空数据）、--count（指定生成数量）。使用Faker库生成随机数据。示例命令：python scripts/seed_data.py --clear --count 50。验证：执行脚本后查询数据库确认数据已生成。
----[ ] NAME:0.8.4 配置数据库性能监控 DESCRIPTION:参考2.md第四部分26数据库查询性能监控。配置PostgreSQL慢查询日志：log_min_duration_statement=1000（记录超过1秒的查询）。启用pg_stat_statements扩展分析查询性能。创建scripts/analyze_slow_queries.py脚本生成慢查询报告。在Grafana中添加数据库性能监控面板（查询次数、平均响应时间、慢查询数量）。验证：执行慢查询后在Grafana中查看监控数据。
--[ ] NAME:Phase 1: 最小可行产品 (MVP) - 建立骨架与核心规则 (4-6周) DESCRIPTION:参考2.md第三部分Phase 1。目标：搭建并验证整个系统的基础骨架和基于规则的核心交易流程。关键交付物：可运行的MVP系统（4个服务+前端）、基于规则的信号生成和仓位管理、方案A完整实现（策略层建议仓位权重）、健壮的错误处理和重试机制。
---[ ] NAME:1.1 基础数据采集 (DataHubService) DESCRIPTION:参考2.md Phase 1功能点1。实现BinanceAdapter获取K线数据，创建API端点/klines，设计并创建klines数据表，初始化Alembic数据库迁移，配置数据库连接池和Redis连接池，实现速率限制和重试、数据缓存、健康检查、全局异常处理。
----[ ] NAME:1.1.1 创建DataHubService目录结构 DESCRIPTION:在services/目录创建文件夹e:\projectBedrock\services\datahub。创建子目录：app/, app/adapters/, app/api/, app/models/, app/core/, tests/。这是DataHubService的基础目录结构。
----[ ] NAME:1.1.2 创建DataHubService的Dockerfile DESCRIPTION:在services/datahub/目录创建文件e:\projectBedrock\services\datahub\Dockerfile。参考2.md第四部分17技术栈版本锁定。使用python:3.11-slim作为基础镜像，安装依赖，配置工作目录。
----[ ] NAME:1.1.3 创建DataHubService的requirements.txt DESCRIPTION:在services/datahub/目录创建文件e:\projectBedrock\services\datahub\requirements.txt。参考2.md第二部分2.2技术栈选型。包含：fastapi==0.104.1, uvicorn[standard]==0.24.0, sqlalchemy==2.0.23, asyncpg==0.29.0, redis==5.0.1, pydantic==2.5.0, python-binance==1.0.19, tenacity==8.2.3, structlog==23.2.0, alembic==1.12.1, prometheus-client==0.19.0。
----[ ] NAME:1.1.4 初始化Alembic数据库迁移 DESCRIPTION:在services/datahub/目录执行：alembic init alembic。这将创建alembic/目录和alembic.ini配置文件。参考2.md第四部分19数据库迁移最佳实践。
----[ ] NAME:1.1.5 配置Alembic连接字符串 DESCRIPTION:编辑services/datahub/alembic/env.py，从环境变量读取数据库连接字符串。配置sqlalchemy.url使用异步引擎。参考2.md第四部分12数据库连接池配置。
----[ ] NAME:1.1.6 创建数据库配置模块 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\core\database.py。参考2.md第四部分12数据库连接池配置。实现create_async_engine，配置pool_size=10, max_overflow=20, pool_pre_ping=True, pool_recycle=3600。创建async_session_maker。
----[ ] NAME:1.1.7 创建Redis配置模块 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\core\redis.py。参考2.md第四部分13 Redis连接池配置。使用redis.asyncio.ConnectionPool，配置max_connections=50, decode_responses=True。实现get_redis依赖注入函数。
----[ ] NAME:1.1.8 创建配置管理模块 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\core\config.py。使用Pydantic Settings从环境变量读取配置。参考2.md第四部分16环境变量命名规范。定义DATABASE_URL, REDIS_URL, BINANCE_API_KEY, BINANCE_API_SECRET等配置项。
----[ ] NAME:1.1.9 设计Kline数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\models\kline.py。定义Kline SQLAlchemy模型。字段包括：id(UUID), symbol(VARCHAR), interval(VARCHAR), open_time(TIMESTAMP), open(DECIMAL), high(DECIMAL), low(DECIMAL), close(DECIMAL), volume(DECIMAL), close_time(TIMESTAMP)。添加复合索引(symbol, interval, open_time)。
----[ ] NAME:1.1.10 创建Kline数据库迁移 DESCRIPTION:执行：alembic revision --autogenerate -m "Create klines table"。检查生成的迁移文件，确认SQL语句正确。参考2.md第四部分19数据库迁移最佳实践。
----[ ] NAME:1.1.11 执行数据库迁移 DESCRIPTION:执行：alembic upgrade head。验证klines表已成功创建。参考2.md第四部分15数据库迁移执行时机。
----[ ] NAME:1.1.12 定义ExchangeInterface抽象接口 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\adapters\exchange_interface.py。参考2.md第一部分1.2核心架构原则（接口隔离与可插拔性）。定义抽象基类ExchangeInterface，声明get_klines抽象方法。
----[ ] NAME:1.1.13 实现BinanceAdapter DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\adapters\binance_adapter.py。实现ExchangeInterface接口。使用python-binance库的AsyncClient。实现get_klines方法，参数：symbol, interval, limit。参考2.md Phase 1功能点1优化增强（速率限制和重试）。
----[ ] NAME:1.1.14 实现API速率限制和重试机制 DESCRIPTION:在BinanceAdapter中使用tenacity库实现重试机制。参考2.md第四部分6重试机制。配置：@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=1, min=2, max=10))。捕获BinanceAPIException，实现指数退避重试。
----[ ] NAME:1.1.15 创建Kline Pydantic Schema DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\api\schemas.py。定义KlineResponse Pydantic模型用于API响应验证。参考2.md第四部分10数据验证。字段与数据库模型对应，添加Config类配置orm_mode=True。
----[ ] NAME:1.1.16 实现/klines API端点 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\api\klines.py。实现GET /v1/klines端点。参考2.md第四部分4.3.4 DataHubService API契约。查询参数：symbol, interval, limit（默认500，最大1000）。使用Pydantic验证参数。调用BinanceAdapter获取数据。
----[ ] NAME:1.1.17 实现Redis缓存逻辑 DESCRIPTION:在/klines端点实现缓存逻辑。参考2.md Phase 1功能点1优化增强（数据缓存）。缓存键格式：klines:{symbol}:{interval}:{limit}。缓存过期时间动态调整：1分钟K线缓存60秒，5分钟K线缓存180秒，15分钟K线缓存300秒，1小时K线缓存600秒，4小时K线缓存1200秒，1天K线缓存3600秒。先查缓存，未命中则调用API并缓存结果。
----[ ] NAME:1.1.18 实现数据持久化逻辑 DESCRIPTION:在/klines端点实现数据持久化。参考2.md Phase 1功能点1优化增强（数据持久化）。使用upsert逻辑（INSERT ... ON CONFLICT UPDATE）将K线数据保存到PostgreSQL。避免重复插入相同时间戳的数据。
----[ ] NAME:1.1.19 实现健康检查端点 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\api\health.py。参考2.md第四部分7健康检查。实现GET /health端点（简单存活检查，返回{"status": "healthy"}）。实现GET /ready端点（检查数据库、Redis、Binance API连接，返回详细状态）。
----[ ] NAME:1.1.20 实现全局异常处理 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\core\exceptions.py。参考2.md第四部分2错误响应标准化。定义自定义异常类。在main.py中添加全局异常处理器，统一返回格式：{"error_code": "...", "message": "...", "timestamp": "...", "request_id": "..."}。
----[ ] NAME:1.1.21 配置CORS中间件 DESCRIPTION:在main.py中配置CORS中间件。参考2.md第四部分21 CORS安全配置。从环境变量CORS_ORIGINS读取允许的来源。开发环境允许http://localhost:3000和http://localhost:5173。
----[ ] NAME:1.1.22 配置请求日志中间件 DESCRIPTION:在main.py中配置请求日志中间件。参考2.md第四部分22请求日志中间件。使用structlog记录请求方法、路径、状态码、响应时间。生成唯一request_id，添加到响应头X-Request-ID。
----[ ] NAME:1.1.23 实现Prometheus metrics端点 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\api\metrics.py。参考2.md第四部分8监控指标。使用prometheus-client库。实现GET /metrics端点，暴露系统指标（请求数、响应时间、错误率）和业务指标（API调用次数、缓存命中率）。
----[ ] NAME:1.1.24 创建DataHubService主应用 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\main.py。初始化FastAPI应用，配置标题、版本、OpenAPI文档。注册所有路由（v1_router包含klines, health, metrics）。配置中间件（CORS、请求日志）。配置全局异常处理。
----[ ] NAME:1.1.25 更新docker-compose.yml添加DataHubService DESCRIPTION:编辑e:\projectBedrock\docker-compose.yml。参考2.md第四部分14 Docker Compose健康检查配置。添加datahub服务，使用build: ./services/datahub，配置环境变量，映射端口8001:8001，添加depends_on（postgres和redis的condition: service_healthy），添加healthcheck。
----[ ] NAME:1.1.26 编写DataHubService单元测试 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\tests\test_binance_adapter.py。使用pytest和pytest-asyncio。测试BinanceAdapter的get_klines方法。使用mock模拟Binance API响应。测试正常情况、API错误、重试机制。
----[ ] NAME:1.1.27 编写DataHubService集成测试 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\tests\test_api.py。测试/v1/klines端点。使用TestClient。测试参数验证、缓存逻辑、数据持久化。测试健康检查端点。目标覆盖率>70%。
----[ ] NAME:1.1.28 启动并验证DataHubService DESCRIPTION:执行：docker-compose up -d datahub。等待服务启动。访问http://localhost:8001/docs验证Swagger UI可访问。测试GET /v1/klines?symbol=BTCUSDT&interval=1h&limit=10，验证返回K线数据。测试GET /health和GET /ready，验证健康检查正常。
----[ ] NAME:1.1.28.1 定义ChainDataInterface抽象接口 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\adapters\chain_data_interface.py。参考2.md第一部分1.2核心架构原则（接口隔离与可插拔性）。定义抽象基类ChainDataInterface。声明抽象方法：get_large_transfers(获取大额转账)、get_smart_money_activity(获取聪明钱动向)、get_exchange_netflow(获取交易所净流入/流出)、get_active_addresses(获取活跃地址数)。每个方法返回统一的数据格式。验证：创建测试用例确认接口定义正确。
----[ ] NAME:1.1.28.2 实现BitqueryAdapter DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\adapters\bitquery_adapter.py。实现ChainDataInterface接口。使用requests库调用Bitquery GraphQL API。实现get_large_transfers方法：查询指定时间范围内的大额转账（如>100 BTC）。实现get_smart_money_activity方法：追踪已知聪明钱地址的交易活动。实现get_exchange_netflow方法：计算交易所净流入/流出。实现get_active_addresses方法：统计活跃地址数。使用tenacity库实现重试机制：@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=2, min=4, max=30))。验证：使用mock测试所有方法。
----[ ] NAME:1.1.28.2.1 验证Bitquery API Key和配额 DESCRIPTION:创建文件e:\projectBedrock\scripts\verify_bitquery_api.py。功能：1)读取.env文件中的BITQUERY_API_KEY和BITQUERY_API_URL。2)发送测试GraphQL查询（如查询最近1小时的BTC大额转账）。3)检查API响应是否成功（状态码200，无错误信息）。4)检查API配额限制：从响应头或API文档获取每日/每月配额信息。5)记录配额消耗速率：估算开发和测试阶段的API调用频率。6)如果API Key无效或配额不足，输出警告并提供降级方案：使用mock数据（创建e:\projectBedrock\services\datahub\tests\fixtures\mock_chain_data.json）。7)在README.md中记录Bitquery API的免费配额限制和付费方案。验证：执行python scripts/verify_bitquery_api.py，确认输出API Key状态和配额信息。
----[ ] NAME:1.1.28.3 配置Bitquery API环境变量 DESCRIPTION:编辑e:\projectBedrock\.env.example。添加BITQUERY_API_KEY=your_bitquery_api_key_here。添加BITQUERY_API_URL=https://graphql.bitquery.io。在README.md中添加获取Bitquery API Key的说明：访问https://bitquery.io/注册账号，创建API Key。提醒用户在.env文件中填入真实的Bitquery API Key。验证：检查.env.example文件包含Bitquery配置。
----[ ] NAME:1.1.28.4 创建ChainData数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\models\chain_data.py。定义ChainData SQLAlchemy模型。字段包括：id(UUID), data_type(VARCHAR: large_transfer/smart_money/exchange_netflow/active_addresses), blockchain(VARCHAR), symbol(VARCHAR), value(DECIMAL), metadata(JSONB: 存储额外信息如transaction_hash, from_address, to_address), timestamp(TIMESTAMP), created_at(TIMESTAMP)。添加索引：(symbol, data_type, timestamp), (blockchain, timestamp)。验证：检查模型定义正确。
----[ ] NAME:1.1.28.5 创建数据库迁移 DESCRIPTION:在DataHubService中执行：alembic revision --autogenerate -m "Create chain_data table"。检查迁移文件确认表结构正确。执行：alembic upgrade head。验证：连接数据库确认chain_data表已创建。
----[ ] NAME:1.1.28.6 实现GET /v1/chain-data端点 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\api\chain_data.py。实现GET /v1/chain-data端点。查询参数：symbol(必选), data_type(可选), blockchain(可选, 默认ethereum), start_time(可选, 默认过24小时), end_time(可选, 默认现在), limit(默认20, 最大100)。调用BitqueryAdapter获取数据。保存到数据库。实现Redis缓存：缓存键格式：chain:data:{symbol}:{data_type}:{start_time}:{end_time}，缓存过期时间：5-15分钟。返回ChainData列表。验证：测试GET /v1/chain-data?symbol=BTCUSDT&data_type=large_transfer。
----[ ] NAME:1.1.28.7 更新DataHubService主应用注册chain-data路由 DESCRIPTION:编辑e:\projectBedrock\services\datahub\app\main.py。导入chain_data router。注册chain_data router到v1_router。验证：访问http://localhost:8001/docs确认/v1/chain-data端点显示在Swagger UI中。
---[ ] NAME:1.2 规则引擎实现 (DecisionEngineService) DESCRIPTION:参考2.md Phase 1功能点2。实现市场筛选逻辑，实现回调买入和三合一退出算法，创建API端点/signals/*，设计并创建signals数据表（包含suggested_position_weight字段），实现事件发布逻辑，配置数据库和Redis连接池，实现健康检查和定时任务。
----[ ] NAME:1.2.1 创建DecisionEngineService目录结构 DESCRIPTION:在services/目录创建文件夹e:\projectBedrock\services\decision_engine。创建子目录：app/, app/strategies/, app/engines/, app/api/, app/models/, app/core/, app/events/, tests/。
----[ ] NAME:1.2.2 创建DecisionEngineService基础文件 DESCRIPTION:创建Dockerfile, requirements.txt（包含fastapi, sqlalchemy, redis, apscheduler==3.10.4）。创建alembic迁移配置。创建app/core/config.py, app/core/database.py, app/core/redis.py（复用DataHubService的模式）。
----[ ] NAME:1.2.3 设计Signal数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\models\signal.py。参考2.md第四部分4.1.1 Signal数据模型。字段包括：id, market, signal_type, entry_price, stop_loss_price, profit_target_price, risk_unit_r, suggested_position_weight(DECIMAL(5,4)), reward_risk_ratio(DECIMAL(5,2), 可为NULL), onchain_signals(JSONB, 可为NULL), created_at, rule_engine_score, ml_confidence_score, llm_sentiment, final_decision, explanation。添加索引。注意：reward_risk_ratio在PullbackEntryStrategy的analyze方法中计算：reward_risk_ratio = (profit_target_price - entry_price) / (entry_price - stop_loss_price)。onchain_signals在MarketFilter的check_onchain_signals方法中填充。
----[ ] NAME:1.2.4 创建Signal数据库迁移 DESCRIPTION:执行：alembic revision --autogenerate -m "Create signals table"。检查迁移文件确认suggested_position_weight、reward_risk_ratio、onchain_signals字段存在。执行：alembic upgrade head。
----[ ] NAME:1.2.5 实现市场筛选逻辑 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\strategies\market_filter.py。实现MarketFilter类，调用DataHubService的/v1/klines端点获取数据。筛选符合趋势条件的市场（如MA上穿、成交量增加）。返回符合条件的symbol列表。
----[ ] NAME:1.2.6 实现回调买入策略 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\strategies\pullback_entry.py。实现PullbackEntryStrategy类。检测价格回调到支撑位（如MA20）。计算entry_price, stop_loss_price, profit_target_price, risk_unit_r。根据信号强度计算suggested_position_weight（高置信度>85: 0.8-1.0, 中等70-85: 0.5-0.7, 低<70: 0.3-0.5）。
----[ ] NAME:1.2.7 实现三合一退出策略 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\strategies\exit_strategy.py。实现ExitStrategy类。实现三种退出机制：1)初始止损（价格触及stop_loss_price）。2)跟踪止损（价格从高点回落超过阈值）。3)获利目标（价格达到profit_target_price）。
----[ ] NAME:1.2.8 实现规则引擎 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\engines\rule_engine.py。实现RuleEngine类。整合MarketFilter, PullbackEntryStrategy, ExitStrategy。实现analyze方法，返回信号列表和rule_engine_score。
----[ ] NAME:1.2.9 实现EventPublisher DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\events\publisher.py。参考2.md第四部分4.2.1 SignalCreated事件契约。实现EventPublisher类，使用Redis Pub/Sub发布事件。实现publish_signal_created方法，包含suggested_position_weight字段。实现重试机制（失败时保存到failed_events表）。
----[ ] NAME:1.2.10 创建failed_events表 DESCRIPTION:创建数据库模型e:\projectBedrock\services\decision_engine\app\models\failed_event.py。字段：id, event_type, event_data(JSONB), error_message, retry_count, created_at。创建迁移并执行。
----[ ] NAME:1.2.11 实现POST /v1/signals/generate端点 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\api\signals.py。参考2.md第四部分4.3.1 DecisionEngineService API契约。实现POST /v1/signals/generate端点。调用RuleEngine.analyze生成信号。保存Signal到数据库。调用EventPublisher.publish_signal_created发布事件。返回Signal对象（包含suggested_position_weight）。
----[ ] NAME:1.2.12 实现GET /v1/signals/list端点 DESCRIPTION:在signals.py中实现GET /v1/signals/list端点。参考2.md第四部分4分页。支持查询参数：market, limit(默认20, 最大100), offset。使用Redis缓存（5分钟）。返回分页信息和信号列表。
----[ ] NAME:1.2.13 实现GET /v1/signals/{signal_id}端点 DESCRIPTION:在signals.py中实现GET /v1/signals/{signal_id}端点。查询单个信号详情。返回Signal对象。
----[ ] NAME:1.2.14 实现定时任务 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\core\scheduler.py。参考2.md Phase 1功能点2优化增强（定时任务）。使用APScheduler定期触发信号生成（如每小时1次）。调用/v1/signals/generate端点。
----[ ] NAME:1.2.15 实现健康检查和metrics DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\api\health.py和metrics.py。实现/health, /ready, /metrics端点。/ready检查数据库、Redis、DataHubService可用性。/metrics暴露signal_generated_total, signal_approved_total等业务指标。
----[ ] NAME:1.2.16 创建DecisionEngineService主应用 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\main.py。初始化FastAPI应用。注册路由（v1_router）。配置中间件（CORS、请求日志、全局异常处理）。启动时初始化APScheduler。
----[ ] NAME:1.2.17 更新docker-compose.yml添加DecisionEngineService DESCRIPTION:编辑docker-compose.yml。添加decision_engine服务，映射端口8002:8002。配置depends_on（postgres, redis, datahub的condition: service_healthy）。添加healthcheck。
----[ ] NAME:1.2.18 编写单元测试 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\tests\test_strategies.py。测试PullbackEntryStrategy的suggested_position_weight计算逻辑。测试不同置信度分数对应的权重范围。测试"哎呀"信号生成逻辑和reward_risk_ratio计算。目标覆盖率>70%。
----[ ] NAME:1.2.18.1 测试MarketFilter的链上数据筛选 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\tests\test_market_filter.py。测试MarketFilter的check_onchain_signals方法。使用mock模拟DataHubService的/v1/chain-data端点响应。测试不同链上数据场景：1) 大额转账次数>5，验证加分10分。2) 交易所净流出>1000 BTC，验证加分15分。3) 聪明钱净买入>0，验证加分20分。4) 活跃地址增长>20%，验证加分5分。5) 多个条件同时满足，验证分数累加。6) 无链上数据，验证不影响基础分数。测试onchain_signals字段正确存储链上信号详情。目标覆盖率>70%。
----[ ] NAME:1.2.19 启动并验证DecisionEngineService DESCRIPTION:执行：docker-compose up -d decision_engine。访问http://localhost:8002/docs。测试POST /v1/signals/generate，验证返回的Signal包含suggested_position_weight、reward_risk_ratio、onchain_signals字段。检查Redis中是否发布了SignalCreated事件。验证定时任务是否正常运行。
----[ ] NAME:1.2.6.1 在PullbackEntryStrategy中添加"哎呀"信号 DESCRIPTION:编辑文件e:\projectBedrock\services\decision_engine\app\strategies\pullback_entry.py。在PullbackEntryStrategy类中添加detect_oops_signal方法。实现逻辑：IF Today_Open < Yesterday_Low AND Current_Price > Yesterday_Low，则生成"哎呀买入"信号，entry_price = Yesterday_Low。将OOPS_BUY添加到signal_type枚举（现有：PULLBACK_BUY，新增：OOPS_BUY）。在analyze方法中同时检测回调买入和哎呀信号，优先返回置信度更高的信号。同时在analyze方法中计算reward_risk_ratio = (profit_target_price - entry_price) / (entry_price - stop_loss_price)。验证：创建测试用例test_oops_signal.py，测试"哎呀"信号生成逻辑和reward_risk_ratio计算。
----[ ] NAME:1.2.5.1 在MarketFilter中集成链上数据筛选 DESCRIPTION:编辑文件e:\projectBedrock\services\decision_engine\app\strategies\market_filter.py。在MarketFilter类中添加check_onchain_signals方法。调用DataHubService的GET /v1/chain-data端点获取链上数据。筛选逻辑：1) 如果过24小时大额转账次数(large_transfer) > Threshold_A(默认5)，标记为"鲸鱼活跃"，加分10分。 2) 如果交易所净流出(exchange_netflow) > Threshold_B(默认1000 BTC)，标记为"资金流出"，加分15分。 3) 如果聪明钱净买入(smart_money) > 0，标记为"聪明钱买入"，加分20分。 4) 如果活跃地址数(active_addresses)增长 > 20%，标记为"地址活跃度上升"，加分5分。将链上信号分数添加到rule_engine_score。将链上信号详情存储到onchain_signals(JSONB)字段。验证：触发信号生成，检查返回的Signal对象包含onchain_signals字段和链上数据。
---[ ] NAME:1.3 仓位与资金管理 (PortfolioService) DESCRIPTION:参考2.md Phase 1功能点3。实现事件订阅逻辑监听SignalCreated事件，实现头寸规模计算逻辑（优先使用suggested_position_weight），实现模拟交易逻辑，设计并创建positions, trades, account数据表，创建API端点/positions/*, /positions/estimate，配置数据库和Redis连接池。
----[ ] NAME:1.3.1 创建PortfolioService目录结构 DESCRIPTION:在services/目录创建文件夹e:\projectBedrock\services\portfolio。创建子目录：app/, app/services/, app/api/, app/models/, app/core/, app/events/, tests/。
----[ ] NAME:1.3.2 创建PortfolioService基础文件 DESCRIPTION:创建Dockerfile, requirements.txt。创建alembic配置。创建app/core/config.py, app/core/database.py, app/core/redis.py。
----[ ] NAME:1.3.3 设计Position数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\models\position.py。参考2.md第四部分4.1.2 Position数据模型。字段包括：id, market, signal_id, position_size, entry_price, current_price, stop_loss_price, profit_target_price, position_weight_used(DECIMAL(5,4)), status, unrealized_pnl, created_at, closed_at, exit_reason。添加索引。
----[ ] NAME:1.3.4 设计Trade和Account数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\models\trade.py和account.py。参考2.md第四部分4.1.3 Trade和4.1.4 Account数据模型。Trade字段：id, position_id, trade_type, market, quantity, price, timestamp, commission, realized_pnl。Account字段：id, balance, available_balance, frozen_balance, updated_at。
----[ ] NAME:1.3.5 创建数据库迁移 DESCRIPTION:执行：alembic revision --autogenerate -m "Create positions, trades, account tables"。检查迁移文件确认position_weight_used字段存在。执行：alembic upgrade head。
----[ ] NAME:1.3.6 实现EventSubscriber DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\events\subscriber.py。参考2.md第四部分4.2.1 SignalCreated事件契约。实现EventSubscriber类，使用Redis Pub/Sub订阅signal.created频道。实现on_signal_created回调函数。实现错误恢复机制（失败时保存到failed_signal_events表）。
----[ ] NAME:1.3.7 实现PositionSizer DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\services\position_sizer.py。参考2.md第四部分4.1.2 Position方案A实现逻辑。实现calculate_position_size方法：1)检查信号是否包含suggested_position_weight。2)如果有：position_size = account_balance * suggested_position_weight / entry_price。3)如果没有：使用默认固定风险算法。4)记录使用的权重到position_weight_used字段。
----[ ] NAME:1.3.8 实现模拟交易逻辑 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\services\trade_executor.py。实现TradeExecutor类。实现open_position方法：创建Position记录，创建Trade记录，更新Account余额（frozen_balance += position_cost）。实现close_position方法：更新Position状态，创建Trade记录，更新Account余额。
----[ ] NAME:1.3.9 实现EventPublisher DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\events\publisher.py。参考2.md第四部分4.2.2 PortfolioUpdated事件契约。实现publish_portfolio_updated方法，包含position_weight_used字段。实现publish_position_closed方法。
----[ ] NAME:1.3.10 实现GET /v1/positions端点 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\api\positions.py。参考2.md第四部分4.3.2 PortfolioService API契约。实现GET /v1/positions端点。支持查询参数：market, status, limit, offset。返回Position列表（包含position_weight_used）。使用Redis缓存（30秒）。
----[ ] NAME:1.3.11 实现GET /v1/positions/estimate端点 DESCRIPTION:在positions.py中实现GET /v1/positions/estimate端点。参考2.md第四部分4.3.2方案A。接收signal_id参数。查询Signal。调用PositionSizer.calculate_position_size。返回{"estimated_position_size": ..., "estimated_cost": ..., "risk_percentage": ..., "position_weight_used": ...}。
----[ ] NAME:1.3.12 实现其他API端点 DESCRIPTION:在positions.py中实现GET /v1/positions/{position_id}, GET /v1/trades, GET /v1/stats端点。实现健康检查和metrics端点。
----[ ] NAME:1.3.13 创建PortfolioService主应用 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\main.py。初始化FastAPI应用。注册路由。配置中间件。启动时初始化EventSubscriber（在后台线程运行）。
----[ ] NAME:1.3.14 更新docker-compose.yml添加PortfolioService DESCRIPTION:编辑docker-compose.yml。添加portfolio服务，映射端口8003:8003。配置depends_on（postgres, redis, decision_engine）。添加healthcheck。
----[ ] NAME:1.3.15 编写测试 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\tests\test_position_sizer.py。测试PositionSizer的calculate_position_size方法。测试使用suggested_position_weight和默认算法两种情况。验证position_weight_used字段记录正确。目标覆盖率>70%。
----[ ] NAME:1.3.16 启动并验证PortfolioService DESCRIPTION:执行：docker-compose up -d portfolio。访问http://localhost:8003/docs。触发一个信号生成，验证PortfolioService自动创建仓位。测试GET /v1/positions/estimate，验证返回position_weight_used。检查Redis中是否发布了PortfolioUpdated事件。
---[ ] NAME:1.4 基础前端展示 (WebApp) DESCRIPTION:参考2.md Phase 1功能点4。使用Vite初始化React+TypeScript项目，安装依赖（react-router-dom, axios, @tanstack/react-query, antd, recharts），创建API服务层，创建信号列表组件（显示suggested_position_weight），创建仓位列表组件（调用/positions/estimate），创建仪表盘页面，配置路由。
----[ ] NAME:1.4.1 初始化React项目 DESCRIPTION:在webapp/目录执行：npm create vite@latest . -- --template react-ts。这将初始化一个React + TypeScript + Vite项目。参考2.md第二部分2.2技术栈选型。
----[ ] NAME:1.4.2 安装依赖 DESCRIPTION:在webapp/目录执行：npm install react-router-dom@6 axios@1.6.0 @tanstack/react-query@5.8.0 antd@5.11.0 recharts@2.10.0 zod@3.22.0。参考2.md第二部分2.2技术栈选型。
----[ ] NAME:1.4.3 配置环境变量 DESCRIPTION:创建文件e:\projectBedrock\webapp\.env.development和.env.production。参考2.md Phase 1功能点4优化增强。定义VITE_API_BASE_URL=http://localhost:8002, VITE_WS_URL=ws://localhost:8006。
----[ ] NAME:1.4.4 创建API服务层 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\services\api.ts。配置axios实例，设置baseURL从环境变量读取。添加请求拦截器（添加request_id）。添加响应拦截器（统一错误处理）。
----[ ] NAME:1.4.5 创建signalService DESCRIPTION:创建文件e:\projectBedrock\webapp\src\services\signalService.ts。定义Signal类型（包含suggested_position_weight字段）。使用zod验证API响应。实现getSignals, getSignalById, generateSignal方法。
----[ ] NAME:1.4.6 创建portfolioService DESCRIPTION:创建文件e:\projectBedrock\webapp\src\services\portfolioService.ts。定义Position类型（包含position_weight_used字段）。实现getPositions, getPositionById, estimatePosition方法。
----[ ] NAME:1.4.7 配置React Query DESCRIPTION:创建文件e:\projectBedrock\webapp\src\config\queryClient.ts。配置QueryClient，设置默认缓存时间、5分钟。在App.tsx中使用QueryClientProvider包裹应用。
----[ ] NAME:1.4.7.1 配置全局状态管理（Zustand） DESCRIPTION:安装Zustand：npm install zustand。创建文件e:\projectBedrock\webapp\src\stores\authStore.ts：实现AuthStore管理用户认证状态（user, token, isAuthenticated, login, logout方法）。创建文件e:\projectBedrock\webapp\src\stores\themeStore.ts：实现ThemeStore管理主题状态（theme: 'light'|'dark', toggleTheme方法），使用localStorage持久化主题偏好。创建文件e:\projectBedrock\webapp\src\stores\websocketStore.ts：实现WebSocketStore管理WebSocket连接状态（isConnected, connectionStatus: 'connected'|'disconnected'|'reconnecting', lastMessage, connect, disconnect方法）。在App.tsx中初始化所有Store。验证：在浏览器控制台测试Store的读写功能。
----[ ] NAME:1.4.8 创建SignalList组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\SignalList.tsx。参考2.md Phase 1功能点4方案A。使用antd的Table组件。显示列：market, signal_type（使用不同颜色或图标区分PULLBACK_BUY和OOPS_BUY，PULLBACK_BUY显示蓝色Tag，OOPS_BUY显示橙色Tag）, entry_price, stop_loss_price, profit_target_price, reward_risk_ratio（使用Tag组件标记：绿色>2, 黄色1-2, 红色<1）, suggested_position_weight（使用Progress组件显示百分比）, rule_engine_score, created_at。使用useQuery获取数据。
----[ ] NAME:1.4.8.1 在SignalList中显示链上指标 DESCRIPTION:编辑文件e:\projectBedrock\webapp\src\components\SignalList.tsx。添加链上指标列：显示onchain_signals字段。使用antd的Tag组件显示链上信号标签："鲸鱼活跃"(蓝色), "资金流出"(绿色), "聪明钱买入"(金色), "地址活跃度上升"(紫色)。添加Tooltip显示详细数据：大额转账次数、交易所净流出量、聪明钱净买入量、活跃地址增长率。如果onchain_signals为null或空，显示'-'。验证：在SignalList中查看链上指标正常显示。
----[ ] NAME:1.4.9 创建PositionList组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\PositionList.tsx。参考2.md Phase 1功能点4方案A。使用antd的Table组件。显示列：market, position_size, entry_price, current_price, unrealized_pnl, position_weight_used, status。添加“预估”按钮，点击后调用/positions/estimate显示预估信息。
----[ ] NAME:1.4.10 创建Dashboard页面 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\pages\Dashboard.tsx。使用antd的Layout组件。显示统计指标（总余额、未实现盈亏、胜率）。嵌入SignalList和PositionList组件。
----[ ] NAME:1.4.11 配置路由 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\router.tsx。使用react-router-dom配置路由。定义路由：/ -> Dashboard。在App.tsx中使用RouterProvider。
----[ ] NAME:1.4.12 创建ErrorBoundary组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\ErrorBoundary.tsx。参考2.md Phase 1功能点4优化增强。捕获渲染错误，显示友好的错误页面。
----[ ] NAME:1.4.13 创建Loading组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\Loading.tsx。使用antd的Spin组件。创建Skeleton组件用于列表加载。
----[ ] NAME:1.4.14 创建webapp的Dockerfile DESCRIPTION:创建文件e:\projectBedrock\webapp\Dockerfile。使用多阶段构建：1)构建阶段：node:18-alpine, npm run build。2)运行阶段：nginx:alpine, 复制构建产物到/usr/share/nginx/html。
----[ ] NAME:1.4.15 更新docker-compose.yml添加webapp DESCRIPTION:编辑docker-compose.yml。添加webapp服务，映射端口3000:80。配置depends_on（decision_engine, portfolio）。
----[ ] NAME:1.4.16 启动并验证webapp DESCRIPTION:执行：docker-compose up -d webapp。访问http://localhost:3000。验证Dashboard页面显示正常。验证SignalList显示suggested_position_weight列。验证PositionList的“预估”功能正常工作。
----[ ] NAME:1.4.12.1 创建EducationTips组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\EducationTips.tsx。使用antd的Alert和Card组件。实现三类教育提示：1) 风险管理提示："头寸规模是您唯一能完全控制的风险。请严格遵守！"（显示在PositionList上方，type="warning"）。2) 盈亏比展示：接收signal对象作为props，显示"此交易计划的潜在盈亏比为 {reward_risk_ratio}:1"，使用Tag组件标记（绿色：>2, 黄色：1-2, 红色：<1）。3) 预期值教育："请记住，长期盈利依赖于正期望值，而非100%的胜率。即使连续亏损，只要坚持策略，数学优势最终会体现出来。"（显示在Dashboard底部，type="info"）。支持可折叠/展开。验证：在Dashboard中查看所有提示正常显示。
----[ ] NAME:1.4.12.2 在Dashboard中集成EducationTips DESCRIPTION:编辑文件e:\projectBedrock\webapp\src\pages\Dashboard.tsx。在SignalList组件上方添加EducationTips组件，传入当前选中的signal对象（如果有）。在PositionList组件上方添加风险管理提示。在页面底部添加预期值教育提示。使用antd的Space组件控制间距。添加用户偏好设置：允许用户隐藏/显示教育提示（使用localStorage保存偏好）。验证：访问Dashboard，确认所有教育提示正确显示，测试折叠/展开功能。
----[ ] NAME:1.4.8.1 在SignalList中显示链上指标 DESCRIPTION:编辑文件e:\projectBedrock\webapp\src\components\SignalList.tsx。添加链上指标列：显示onchain_signals字段。使用antd的Tag组件显示链上信号标签："鲸鱼活跃"(蓝色), "资金流出"(绿色), "聪明钱买入"(金色), "地址活跃度上升"(紫色)。添加Tooltip显示详细数据：大额转账次数、交易所净流出量、聪明钱净买入量、活跃地址增长率。如果onchain_signals为null或空，显示'-'。验证：在SignalList中查看链上指标正常显示。
---[ ] NAME:1.5 集成测试 DESCRIPTION:参考2.md Phase 1功能点5。启动所有Phase 1服务，执行端到端测试：触发信号生成 -> 仓位更新 -> 前端展示。验证数据流转和事件发布/订阅机制。验证方案A的完整实现（信号生成权重 -> 仓位计算 -> 前端显示）。
----[ ] NAME:1.5.1 启动所有Phase 1服务 DESCRIPTION:执行：docker-compose up -d postgres redis datahub decision_engine portfolio webapp。等待所有服务启动完成。执行：docker-compose ps，确认所有服务状态为Up (healthy)。
----[ ] NAME:1.5.2 验证数据库连接 DESCRIPTION:执行：docker-compose exec postgres psql -U postgres -d bedrock -c "\dt"。验证klines, signals, positions, trades, account表已创建。检查signals表是否包含suggested_position_weight列。检查positions表是否包含position_weight_used列。
----[ ] NAME:1.5.3 验证Redis连接 DESCRIPTION:执行：docker-compose exec redis redis-cli。执行：PUBSUB CHANNELS，验证signal.created和portfolio.updated频道存在。
----[ ] NAME:1.5.4 测试DataHubService DESCRIPTION:使用curl或Postman测试GET http://localhost:8001/v1/klines?symbol=BTCUSDT&interval=1h&limit=10。验证返回K线数据。检查PostgreSQL中是否保存了数据。检查Redis中是否缓存了数据。
----[ ] NAME:1.5.5 测试DecisionEngineService信号生成 DESCRIPTION:测试POST http://localhost:8002/v1/signals/generate。验证返回的Signal对象包含所有必需字段，特别是suggested_position_weight字段。检查PostgreSQL中signals表是否插入了新记录。
----[ ] NAME:1.5.6 验证SignalCreated事件发布 DESCRIPTION:在另一个终端执行：docker-compose exec redis redis-cli，然后执行：SUBSCRIBE signal.created。再次触发信号生成，验证Redis中接收到SignalCreated事件。检查事件数据包含suggested_position_weight字段。
----[ ] NAME:1.5.7 验证PortfolioService事件订阅 DESCRIPTION:检查PortfolioService日志：docker-compose logs portfolio。验证服务成功订阅了signal.created事件。验证接收到SignalCreated事件后自动创建了Position。
----[ ] NAME:1.5.8 验证仓位创建 DESCRIPTION:测试GET http://localhost:8003/v1/positions。验证返回的Position列表包含position_weight_used字段。检查PostgreSQL中positions表是否插入了新记录。验证position_weight_used值与Signal的suggested_position_weight一致。
----[ ] NAME:1.5.9 测试/positions/estimate端点 DESCRIPTION:获取一个signal_id。测试GET http://localhost:8003/v1/positions/estimate?signal_id={signal_id}。验证返回的预估信息包含estimated_position_size, estimated_cost, risk_percentage, position_weight_used。验证position_weight_used与Signal的suggested_position_weight一致。
----[ ] NAME:1.5.10 验证PortfolioUpdated事件发布 DESCRIPTION:在Redis中订阅portfolio.updated频道。触发一个新的信号生成。验证接收到PortfolioUpdated事件。检查事件数据包含position_weight_used字段。
----[ ] NAME:1.5.11 测试前端显示 DESCRIPTION:访问http://localhost:3000。验证Dashboard页面加载成功。验证SignalList显示了信号列表，并且suggested_position_weight列以进度条形式显示。验证PositionList显示了仓位列表，并且position_weight_used列正常显示。
----[ ] NAME:1.5.12 测试前端预估功能 DESCRIPTION:在PositionList中点击某个信号的“预估”按钮。验证弹出框显示预估信息（estimated_position_size, estimated_cost, risk_percentage, position_weight_used）。验证数据正确。
----[ ] NAME:1.5.13 执行端到端测试 DESCRIPTION:执行完整流程：1)触发信号生成（POST /v1/signals/generate）。2)等待PortfolioService自动创建仓位。3)刷新前端页面，验证新信号和新仓位显示。4)验证整个数据流转：DataHubService -> DecisionEngineService -> Redis Pub/Sub -> PortfolioService -> 前端。
----[ ] NAME:1.5.14 验证方案A完整实现 DESCRIPTION:参考2.md Phase 1功能点5。验证方案A的完整实现：1)信号生成权重：检查Signal的suggested_position_weight字段根据rule_engine_score计算正确。2)仓位计算：检查Position的position_weight_used字段使用了Signal的suggested_position_weight。3)前端显示：检查前端正确显示了这两个字段。
----[ ] NAME:1.5.15 记录测试结果 DESCRIPTION:创建文件e:\projectBedrock\docs\PHASE1_TEST_REPORT.md。记录所有测试结果，包括：测试用例、测试数据、测试结果（通过/失败）、截图、发现的问题、解决方案。确认Phase 1的所有关键交付物已完成。
----[ ] NAME:1.5.16 编写E2E测试脚本 DESCRIPTION:安装Playwright：npm install -D @playwright/test。创建文件e:\projectBedrock\webapp\tests\e2e\dashboard.spec.ts。编写端到端测试用例：1)测试用户访问Dashboard页面。2)测试SignalList加载和显示。3)测试PositionList加载和显示。4)测试"预估"按钮点击和弹窗显示。5)测试信号生成流程（模拟触发信号生成，验证前端实时更新）。6)测试错误处理（模拟API错误，验证错误提示显示）。配置playwright.config.ts：设置baseURL为http://localhost:3000。执行：npx playwright test。验证：所有E2E测试通过。
----[ ] NAME:1.5.17 编写性能基准测试 DESCRIPTION:安装Locust：pip install locust。创建文件e:\projectBedrock\tests\performance\locustfile.py。编写性能测试场景：1)GET /v1/klines（模拟高频K线查询）。2)POST /v1/signals/generate（模拟信号生成）。3)GET /v1/positions（模拟仓位查询）。4)GET /v1/chain-data（模拟链上数据查询）。配置负载：100并发用户，持续5分钟。性能基准：P95响应时间<2秒，错误率<1%，吞吐量>100 RPS。执行：locust -f tests/performance/locustfile.py --host=http://localhost:8001。记录性能基准到e:\projectBedrock\docs\PERFORMANCE_BASELINE.md。验证：所有API满足性能基准。
----[ ] NAME:1.5.18 编写API契约测试 DESCRIPTION:安装Pact：pip install pact-python。创建文件e:\projectBedrock\tests\contract\test_signal_contract.py。编写契约测试：1)定义DecisionEngineService的SignalCreated事件契约（包含所有必需字段：signal_id, market, signal_type, entry_price, suggested_position_weight等）。2)定义PortfolioService订阅SignalCreated事件的契约。3)验证事件发布者和订阅者的契约一致性。4)定义DataHubService的/v1/klines API契约。5)定义DecisionEngineService调用/v1/klines的契约。执行：pytest tests/contract/。生成Pact文件到e:\projectBedrock\pacts/。在CI/CD中集成契约测试，确保服务间API变更不会破坏契约。验证：所有契约测试通过。
---[ ] NAME:1.6 低优先级优化 DESCRIPTION:参考2.md Phase 1低优先级任务。包括批量查询API、前端运行时配置注入、暗黑模式支持、数据导出功能。这些是可选的优化功能，可在MVP完成后实施。
----[ ] NAME:1.6.1 实现批量查询API DESCRIPTION:参考2.md第四部分28批量操作 API。添加批量查询API：POST /v1/signals/batch, POST /v1/positions/batch。请求体：{ "signal_ids": ["id1", "id2", ...] }，最多支持100个ID。使用SQLAlchemy的in_查询提升效率。添加参数验证：列表不能为空，长度不超过100。保持原有顺序返回结果。验证：测试POST /v1/signals/batch批量查询信号。
----[ ] NAME:1.6.2 实现前端运行时配置注入 DESCRIPTION:参考2.md Phase 1功能点4优化增强。创建public/config.js文件存储运行时配置。在index.html中加载<script src="/config.js"></script>。在代码中通过window.APP_CONFIG访问配置。支持配置项：API_BASE_URL, WS_URL, FEATURE_FLAGS。在部署时通过ConfigMap注入config.js。验证：修改config.js后刷新页面，配置生效无需重新构建。
----[ ] NAME:1.6.3 实现暗黑模式支持 DESCRIPTION:参考2.md第四部分31暗黑模式支持。使用Ant Design的ConfigProvider配置主题。实现亮色/暗色主题切换。使用localStorage保存用户主题偏好。支持系统主题检测：window.matchMedia('(prefers-color-scheme: dark)')。创建src/contexts/ThemeContext.tsx实现主题管理。在头部添加主题切换按钮。验证：点击切换按钮，页面主题切换且偏好被保存。
----[ ] NAME:1.6.4 实现数据导出功能 DESCRIPTION:参考2.md第四部分32数据导出功能。在信号列表和仓位列表添加导出按钮。支持CSV和Excel格式导出。限制导出数量：最多10000条记录。导出文件命名格式：signals_2024-11-09.xlsx。使用xlsx库实现导出功能。创建src/utils/export.ts实现exportToExcel和exportToCSV方法。验证：点击导出按钮，下载Excel/CSV文件。
----[ ] NAME:1.6.5 Phase 1技术债务清理 DESCRIPTION:在Phase 1完成后，进行技术债务清理。任务包括：1)代码重构：识别并重构重复代码（如多个服务中的数据库连接逻辑、Redis连接逻辑），提取为共享库。2)性能优化：使用EXPLAIN ANALYZE分析慢查询，添加必要的数据库索引。3)代码注释：为复杂逻辑添加注释（如仓位计算算法、信号生成逻辑）。4)文档更新：更新所有过时的文档（API文档、数据模型文档、架构文档）。5)测试补充：为测试覆盖率<70%的模块补充测试。6)日志优化：统一日志格式，添加缺失的关键日志点。7)错误处理：审查所有API端点的错误处理，确保返回友好的错误信息。创建技术债务清单文件e:\projectBedrock\docs\TECH_DEBT_PHASE1.md，记录所有发现的问题和解决方案。验证：代码质量工具（black, mypy, flake8）无警告，测试覆盖率>70%。
--[ ] NAME:Phase 2: 引入智能与回测 - 验证AI有效性 (6-8周) DESCRIPTION:参考2.md第三部分Phase 2。目标：为系统注入AI大脑，并提供强大的回测工具来量化评估AI策略相对于纯规则策略的提升效果。关键交付物：AI增强的决策系统（规则+ML+LLM）、完整的回测引擎、真实性模拟（滑点、手续费）、高级绩效指标。
---[ ] NAME:2.1 ML引擎集成 DESCRIPTION:参考2.md Phase 2功能点1。定义MLModelInterface适配器接口，实现XGBoostAdapter，修改决策流程调用ML模型，更新Signal模型添加ml_confidence_score字段，实现模型性能基准、加载失败降级、特征文档化。
----[ ] NAME:2.1.1 定义MLModelInterface抽象接口 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\adapters\ml_model_interface.py。参考2.md第一部分1.2核心架构原则。定义抽象基类MLModelInterface，声明predict抽象方法（输入特征，输出置信度分数）。
----[ ] NAME:2.1.2 准备训练数据 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\scripts\prepare_training_data.py。从数据库提取历史K线数据和信号数据。计算技术指标（RSI, MACD, MA, Bollinger Bands, ATR）。生成特征矩阵和标签（信号是否盈利）。保存为CSV或Parquet文件。
----[ ] NAME:2.1.3 训练XGBoost模型 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\scripts\train_xgboost.py。加载训练数据。划分训练集、验证集、测试集（70%/15%/15%）。训练XGBoost模型。计算性能指标（准确率、精确率、召回率、F1、AUC）。参考2.md Phase 2功能点1优化增强（模型性能基准）。
----[ ] NAME:2.1.4 验证模型性能基准 DESCRIPTION:在train_xgboost.py中验证模型性能达到基准：准确率 > 60%。如果未达到，调整特征工程或模型参数。记录所有指标到日志文件。
----[ ] NAME:2.1.5 保存模型文件 DESCRIPTION:使用joblib保存训练好的模型到e:\projectBedrock\services\decision_engine\models\xgboost_signal_confidence_v1.pkl。保存特征名称列表到feature_names.json。
----[ ] NAME:2.1.6 创建ML_MODEL_FEATURES.md文档 DESCRIPTION:创建文件e:\projectBedrock\docs\ML_MODEL_FEATURES.md。参考2.md Phase 2功能点1优化增强（特征文档化）。详细记录所有输入特征：名称、计算方法、取值范围、重要性排名。例如：RSI(14)、MACD、MA(20)等。
----[ ] NAME:2.1.7 实现XGBoostAdapter DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\adapters\xgboost_adapter.py。实现MLModelInterface接口。在__init__中加载模型文件。实现predict方法：接收特征字典，转换为特征向量，调用模型预测，返回置信度分数（0-100）。
----[ ] NAME:2.1.8 实现模型加载失败降级 DESCRIPTION:在XGBoostAdapter的__init__中添加异常处理。参考2.md Phase 2功能点1优化增强（加载失败降级）。如果模型文件不存在或加载失败，记录警告日志并继续执行。predict方法返回null。
----[ ] NAME:2.1.9 更新Signal模型添加ml_confidence_score DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\models\signal.py。添加ml_confidence_score字段（FLOAT, nullable=True）。创建数据库迁移：alembic revision --autogenerate -m "Add ml_confidence_score to signals"。执行迁移：alembic upgrade head。
----[ ] NAME:2.1.10 修改决策流程调用ML模型 DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\engines\rule_engine.py。在analyze方法中，在规则引擎生成信号后，调用XGBoostAdapter.predict获取ML置信度分数。将ml_confidence_score添加到Signal对象。
----[ ] NAME:2.1.11 更新requirements.txt DESCRIPTION:在decision_engine/requirements.txt中添加：scikit-learn==1.3.2, xgboost==2.0.2, joblib==1.3.2, numpy==1.26.2, pandas==2.1.3。参考2.md Phase 2功能点1优化增强（依赖管理）。
----[ ] NAME:2.1.12 编写ML集成测试 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\tests\test_ml_integration.py。测试XGBoostAdapter的predict方法。测试模型加载失败的降级逻辑。测试决策流程中ML分数的正确添加。
----[ ] NAME:2.1.13 重启并验证DecisionEngineService DESCRIPTION:执行：docker-compose restart decision_engine。测试POST /v1/signals/generate。验证返回的Signal包含ml_confidence_score字段。检查日志确认ML模型加载成功。
---[ ] NAME:2.2 LLM引擎集成 DESCRIPTION:参考2.md Phase 2功能点2。定义LLMInterface适配器接口，实现QwenAdapter调用Qwen API分析市场情绪，更新Signal模型添加llm_sentiment字段，实现LLM缓存机制，实现超时处理、配额处理、Prompt管理。
----[ ] NAME:2.2.1 定义LLMInterface抽象接口 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\adapters\llm_interface.py。参考2.md第一部分1.2核心架构原则。定义抽象基类LLMInterface，声明analyze_sentiment抽象方法（输入市场数据和信号，输出情绪分析和解释）。
----[ ] NAME:2.2.2 配置Qwen API环境变量 DESCRIPTION:编辑e:\projectBedrock\.env.example。添加QWEN_API_KEY=your_qwen_api_key_here。提醒用户在.env文件中填入真实的Qwen API Key。
----[ ] NAME:2.2.3 安装dashscope SDK DESCRIPTION:在decision_engine/requirements.txt中添加：dashscope==1.14.0。参考2.md Phase 2功能点2优化增强（依赖管理）。
----[ ] NAME:2.2.4 设计LLM Prompt模板 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\prompts\signal_analysis.txt。参考2.md Phase 2功能点2优化增强（Prompt模板化）。设计Prompt模板，包含：市场数据、技术指标、信号详情。要求LLM输出：情绪分析（bullish/bearish/neutral）、置信度（0-100）、解释。
----[ ] NAME:2.2.5 实现QwenAdapter DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\adapters\qwen_adapter.py。实现LLMInterface接口。在__init__中初始化dashscope客户端。实现analyze_sentiment方法：加载Prompt模板，填充数据，调用Qwen API，解析响应，返回结构化结果。
----[ ] NAME:2.2.6 实现API调用重试机制 DESCRIPTION:在QwenAdapter中使用tenacity库实现重试机制。参考2.md第四部分6重试机制。配置：@retry(stop=stop_after_attempt(3), wait=wait_exponential(multiplier=2, min=4, max=30))。捕获API错误，实现指数退避重试。
----[ ] NAME:2.2.7 实现响应缓存 DESCRIPTION:在QwenAdapter中实现Redis缓存。参考2.md Phase 2功能点2优化增强（响应缓存）。缓存键格式：llm:sentiment:{market}:{signal_hash}。缓存过期时间：1小时。先查缓存，未命中则调用API并缓存结果。
----[ ] NAME:2.2.8 实现API调用失败降级 DESCRIPTION:在QwenAdapter中添加异常处理。参考2.md Phase 2功能点2优化增强（调用失败降级）。如果API调用失败（重试后仍失败），记录警告日志并返回null。决策流程继续执行。
----[ ] NAME:2.2.9 更新Signal模型添加llm_sentiment DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\models\signal.py。添加llm_sentiment字段（VARCHAR(20), nullable=True）。创建数据库迁移并执行。
----[ ] NAME:2.2.10 修改决策流程调用LLM DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\engines\rule_engine.py。在analyze方法中，在ML模型调用后，调用QwenAdapter.analyze_sentiment获取LLM情绪分析。将llm_sentiment和explanation添加到Signal对象。
----[ ] NAME:2.2.11 编写LLM集成测试 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\tests\test_llm_integration.py。测试QwenAdapter的analyze_sentiment方法。使用mock模拟Qwen API响应。测试重试机制、缓存逻辑、失败降级。
----[ ] NAME:2.2.12 重启并验证DecisionEngineService DESCRIPTION:执行：docker-compose restart decision_engine。测试POST /v1/signals/generate。验证返回的Signal包含llm_sentiment和explanation字段。检查日志确认LLM调用成功。
---[ ] NAME:2.3 决策仲裁 DESCRIPTION:参考2.md Phase 2功能点3。实现决策仲裁模块，更新Signal模型添加final_decision和explanation字段，修改事件发布逻辑仅发布APPROVED信号，创建仲裁结果统计接口，实现仲裁策略配置。
----[ ] NAME:2.3.1 设计决策仲裁算法 DESCRIPTION:创建文件e:\projectBedrock\docs\ARBITRATION_ALGORITHM.md。参考2.md Phase 2功能点3。设计仲裁算法：综合rule_engine_score、ml_confidence_score、llm_sentiment三个维度。定义仲裁规则：1)三者一致→APPROVED。2)两者一致→APPROVED（权重加权）。3)三者不一致→REJECTED。定义权重配置：rule_weight, ml_weight, llm_weight（默认0.4, 0.3, 0.3）。
----[ ] NAME:2.3.2 更新Signal模型添加final_decision DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\models\signal.py。添加final_decision字段（VARCHAR(20), 枚举值：APPROVED/REJECTED/PENDING）。添加explanation字段（TEXT, nullable=True）用于存储仲裁解释。创建数据库迁移：alembic revision --autogenerate -m "Add final_decision and explanation to signals"。执行迁移：alembic upgrade head。
----[ ] NAME:2.3.3 创建仲裁配置模型 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\models\arbitration_config.py。定义ArbitrationConfig模型。字段：id, rule_weight(FLOAT), ml_weight(FLOAT), llm_weight(FLOAT), min_approval_score(FLOAT, 默认70.0), updated_at。创建数据库迁移并执行。
----[ ] NAME:2.3.4 实现Arbiter仲裁器 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\engines\arbiter.py。参考2.md Phase 2功能点3。实现Arbiter类。实现arbitrate方法：接收Signal对象，读取ArbitrationConfig，计算综合分数=rule_score*rule_weight + ml_score*ml_weight + llm_sentiment_score*llm_weight。判断是否>min_approval_score。生成explanation文本。返回final_decision和explanation。
----[ ] NAME:2.3.5 实现LLM情绪转分数逻辑 DESCRIPTION:在Arbiter类中实现convert_sentiment_to_score方法。参考2.md Phase 2功能点3优化增强（情绪转分数）。映射规则：bullish→80-100, neutral→40-60, bearish→0-20。考虑LLM返回的置信度调整分数。
----[ ] NAME:2.3.6 修改决策流程调用Arbiter DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\engines\rule_engine.py。在analyze方法中，在LLM调用后，调用Arbiter.arbitrate进行仲裁。将final_decision和explanation添加到Signal对象。保存Signal到数据库。
----[ ] NAME:2.3.7 修改事件发布逻辑 DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\api\signals.py。参考2.md Phase 2功能点3优化增强（仅发布APPROVED信号）。在POST /v1/signals/generate端点中，仅当final_decision=APPROVED时才调用EventPublisher.publish_signal_created发布事件。REJECTED信号仅保存到数据库，不发布事件。
----[ ] NAME:2.3.8 实现GET /v1/arbitration/config端点 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\api\arbitration.py。参考2.md Phase 2功能点3优化增强（仲裁配置管理）。实现GET /v1/arbitration/config端点，返回当前仲裁配置。实现PUT /v1/arbitration/config端点，更新仲裁配置（rule_weight, ml_weight, llm_weight, min_approval_score）。
----[ ] NAME:2.3.9 实现GET /v1/arbitration/stats端点 DESCRIPTION:在arbitration.py中实现GET /v1/arbitration/stats端点。参考2.md Phase 2功能点3优化增强（仲裁统计）。统计信息包括：总信号数、APPROVED数量、REJECTED数量、批准率、各维度平均分数、仲裁一致性分析。支持时间范围过滤（start_date, end_date）。
----[ ] NAME:2.3.10 更新SignalCreated事件契约 DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\events\publisher.py。更新publish_signal_created方法，在事件数据中添加final_decision和explanation字段。更新e:\projectBedrock\docs\DATA_MODEL_AND_API_CONTRACT.md文档，记录SignalCreated事件的新字段。
----[ ] NAME:2.3.11 编写仲裁逻辑测试 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\tests\test_arbiter.py。测试Arbiter.arbitrate方法。测试不同分数组合的仲裁结果。测试边界情况（min_approval_score临界值）。测试LLM情绪转分数逻辑。目标覆盖率>80%。
----[ ] NAME:2.3.12 初始化默认仲裁配置 DESCRIPTION:编辑e:\projectBedrock\scripts\init_db.py。添加初始化ArbitrationConfig的逻辑。插入默认配置：rule_weight=0.4, ml_weight=0.3, llm_weight=0.3, min_approval_score=70.0。
----[ ] NAME:2.3.13 重启并验证仲裁功能 DESCRIPTION:执行：docker-compose restart decision_engine。测试POST /v1/signals/generate。验证返回的Signal包含final_decision和explanation字段。测试GET /v1/arbitration/config，验证返回默认配置。测试GET /v1/arbitration/stats，验证统计数据正确。检查Redis中仅发布了APPROVED信号的事件。
---[ ] NAME:2.4 核心回测功能 (BacktestingService) DESCRIPTION:参考2.md Phase 2功能点4。创建服务骨架和API端点/backtest/*，实现回测循环逻辑，实现核心绩效指标计算，设计并创建backtest_reports, backtest_tasks数据表，集成Celery支持异步回测，实现滑点模拟、手续费计算、高级绩效指标。
----[ ] NAME:2.4.1 创建BacktestingService目录结构 DESCRIPTION:在services/目录创建文件夹e:\projectBedrock\services\backtesting。创建子目录：app/, app/core/, app/api/, app/models/, app/services/, app/tasks/, tests/。
----[ ] NAME:2.4.2 创建BacktestingService基础文件 DESCRIPTION:创建Dockerfile, requirements.txt（包含fastapi, sqlalchemy, redis, celery==5.3.4, pandas==2.1.3, numpy==1.26.2）。创建alembic配置。创建app/core/config.py, app/core/database.py, app/core/redis.py。
----[ ] NAME:2.4.3 设计BacktestTask数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\models\backtest_task.py。参考2.md第四部分4.1.5 BacktestTask数据模型。字段包括：id, task_name, strategy_type, start_date, end_date, initial_balance, status(PENDING/RUNNING/COMPLETED/FAILED), created_at, completed_at, celery_task_id。添加索引。
----[ ] NAME:2.4.4 设计BacktestReport数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\models\backtest_report.py。参考2.md第四部分4.1.6 BacktestReport数据模型。字段包括：id, task_id, total_return, sharpe_ratio, max_drawdown, win_rate, total_trades, avg_trade_duration, profit_factor, calmar_ratio, sortino_ratio, report_data(JSONB)。添加索引。
----[ ] NAME:2.4.5 创建数据库迁移 DESCRIPTION:执行：alembic revision --autogenerate -m "Create backtest_tasks and backtest_reports tables"。检查迁移文件。执行：alembic upgrade head。
----[ ] NAME:2.4.6 配置Celery DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\core\celery_app.py。参考2.md Phase 2功能点4优化增强（Celery集成）。初始化Celery应用，配置broker_url=redis://redis:6379/1, result_backend=redis://redis:6379/1。配置task_serializer='json', result_serializer='json'。
----[ ] NAME:2.4.7 实现数据加载器 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\services\data_loader.py。实现DataLoader类。实现load_historical_klines方法：从数据库加载历史K线数据（指定时间范围）。实现load_historical_signals方法：加载历史信号数据。返回pandas DataFrame。
----[ ] NAME:2.4.8 实现滑点模拟 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\services\slippage.py。参考2.md Phase 2功能点4优化增强（滑点模拟）。实现SlippageModel类。实现calculate_slippage方法：根据订单大小和市场流动性计算滑点。默认滑点模型：fixed_percentage=0.05%。
----[ ] NAME:2.4.9 实现手续费计算 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\services\commission.py。参考2.md Phase 2功能点4优化增强（手续费计算）。实现CommissionModel类。实现calculate_commission方法：计算交易手续费。Binance默认手续费率：maker=0.1%, taker=0.1%。
----[ ] NAME:2.4.10 实现回测引擎核心逻辑 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\services\backtest_engine.py。参考2.md Phase 2功能点4。实现BacktestEngine类。实现run方法：1)加载历史数据。2)初始化账户余额。3)遍历每个时间点。4)根据信号执行交易（考虑滑点和手续费）。5)更新仓位和账户。6)记录交易历史。7)计算综合绯效指标。
----[ ] NAME:2.4.11 实现综合绯效指标计算 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\services\metrics.py。参考2.md Phase 2功能点4优化增强（高级绯效指标）。实现MetricsCalculator类。实现方法：calculate_total_return, calculate_sharpe_ratio, calculate_max_drawdown, calculate_win_rate, calculate_profit_factor, calculate_calmar_ratio, calculate_sortino_ratio。
----[ ] NAME:2.4.12 创建Celery回测任务 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\tasks\backtest_task.py。定义Celery任务run_backtest。参数：task_id, strategy_type, start_date, end_date, initial_balance。任务流程：1)更新BacktestTask状态为RUNNING。2)调用BacktestEngine.run执行回测。3)保存BacktestReport。4)更新BacktestTask状态为COMPLETED。5)异常处理：更新状态为FAILED。
----[ ] NAME:2.4.13 实现POST /v1/backtest/tasks端点 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\api\backtest.py。参考2.md第四部分4.3.3 BacktestingService API契约。实现POST /v1/backtest/tasks端点。接收参数：task_name, strategy_type, start_date, end_date, initial_balance。创建BacktestTask记录。调用Celery任务run_backtest.delay()。返回task_id。
----[ ] NAME:2.4.14 实现GET /v1/backtest/tasks/{task_id}端点 DESCRIPTION:在backtest.py中实现GET /v1/backtest/tasks/{task_id}端点。查询BacktestTask状态。返回task信息和进度。
----[ ] NAME:2.4.15 实现GET /v1/backtest/reports/{task_id}端点 DESCRIPTION:在backtest.py中实现GET /v1/backtest/reports/{task_id}端点。查询BacktestReport。返回完整的回测报告（包括所有绯效指标和report_data）。
----[ ] NAME:2.4.16 实现GET /v1/backtest/tasks端点 DESCRIPTION:在backtest.py中实现GET /v1/backtest/tasks端点。支持分页和过滤（status, strategy_type）。返回回测任务列表。
----[ ] NAME:2.4.17 实现健康检查和metrics DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\api\health.py和metrics.py。实现/health, /ready, /metrics端点。/ready检查数据库、Redis、Celery Worker可用性。
----[ ] NAME:2.4.18 创建BacktestingService主应用 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\main.py。初始化FastAPI应用。注册路由。配置中间件。
----[ ] NAME:2.4.19 更新docker-compose.yml添加BacktestingService DESCRIPTION:编辑docker-compose.yml。添加backtesting服务，映射端口8004:8004。添加celery_worker服务（运行celery -A app.core.celery_app worker --concurrency=4）。配置Celery Worker资源限制：deploy.resources.limits.cpus='2.0', deploy.resources.limits.memory='2g', deploy.resources.reservations.cpus='1.0', deploy.resources.reservations.memory='1g'。配置depends_on。添加healthcheck。验证：执行docker stats查看Celery Worker资源使用情况。
----[ ] NAME:2.4.20 编写回测引擎测试 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\tests\test_backtest_engine.py。测试BacktestEngine.run方法。测试滑点和手续费计算。测试绯效指标计算。目标覆盖率>70%。
----[ ] NAME:2.4.21 启动并验证BacktestingService DESCRIPTION:执行：docker-compose up -d backtesting celery_worker。访问http://localhost:8004/docs。测试POST /v1/backtest/tasks创建回测任务。测试GET /v1/backtest/tasks/{task_id}查询任务状态。等待任务完成后，测试GET /v1/backtest/reports/{task_id}获取报告。验证报告包含所有综合绯效指标。
---[ ] NAME:2.5 前端增强 DESCRIPTION:参考2.md Phase 2功能点5。创建回测页面，在信号展示中加入ML置信度分和LLM情绪分析，创建回测配置表单组件，创建回测结果展示页面，创建决策仲裁详情弹窗，实现报告导出功能。
----[ ] NAME:2.5.1 更新SignalList组件显示ML和LLM分数 DESCRIPTION:编辑e:\projectBedrock\webapp\src\components\SignalList.tsx。参考2.md Phase 2功能点5。添加列：ml_confidence_score（使用Progress组件显示）、llm_sentiment（使用Tag组件，bullish=绿色，bearish=红色，neutral=灰色）、final_decision（使用Badge组件，APPROVED=绿色，REJECTED=红色）。
----[ ] NAME:2.5.2 创建SignalDetail弹窗组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\SignalDetail.tsx。参考2.md Phase 2功能点5优化增强（决策仲裁详情）。使用antd的Modal组件。显示信号详情：规则引擎分数、ML置信度分数、LLM情绪分析、仲裁结果、仲裁解释。使用Descriptions组件展示。
----[ ] NAME:2.5.3 在SignalList中添加查看详情按钮 DESCRIPTION:编辑SignalList.tsx。在操作列添加“查看详情”按钮。点击后打开SignalDetail弹窗，显示完整的信号信息和仲裁详情。
----[ ] NAME:2.5.4 创建BacktestConfig表单组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\BacktestConfig.tsx。参考2.md Phase 2功能点5优化增强（回测配置表单）。使用antd的Form组件。表单字段：task_name, strategy_type(下拉选择), start_date(日期选择器), end_date(日期选择器), initial_balance(数字输入)。添加表单验证。提交后调用POST /v1/backtest/tasks。
----[ ] NAME:2.5.5 创建BacktestResult组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\BacktestResult.tsx。参考2.md Phase 2功能点5优化增强（回测结果展示）。使用antd的Card和Statistic组件。显示关键指标：总收益率、夏普比率、最大回撤、胜率、总交易次数、利润因子、卡玛比率、索提诺比率。使用颜色编码（正值=绿色，负值=红色）。
----[ ] NAME:2.5.6 创建BacktestTaskList组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\BacktestTaskList.tsx。使用antd的Table组件。显示列：task_name, strategy_type, start_date, end_date, status(使用Tag组件), created_at。添加操作列：查看报告按钮（仅当status=COMPLETED时显示）。使用useQuery获取数据。
----[ ] NAME:2.5.7 创建Backtest页面 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\pages\Backtest.tsx。使用antd的Layout组件。左侧显示BacktestConfig表单。右侧显示BacktestTaskList。点击查看报告后，在下方显示BacktestResult。
----[ ] NAME:2.5.8 创建backtestService DESCRIPTION:创建文件e:\projectBedrock\webapp\src\services\backtest Service.ts。定义BacktestTask和BacktestReport类型。实现createBacktestTask, getBacktestTasks, getBacktestTask, getBacktestReport方法。
----[ ] NAME:2.5.9 更新路由配置 DESCRIPTION:编辑e:\projectBedrock\webapp\src\router.tsx。添加路由：/backtest -> Backtest页面。更新导航菜单，添加“回测”菜单项。
----[ ] NAME:2.5.10 创建ArbitrationConfig组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\ArbitrationConfig.tsx。参考2.md Phase 2功能点5优化增强（仲裁配置管理）。使用antd的Form和Slider组件。显示并允许编辑：rule_weight, ml_weight, llm_weight, min_approval_score。添加权重总和验证（必须=1.0）。提交后调用PUT /v1/arbitration/config。
----[ ] NAME:2.5.11 创建ArbitrationStats组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\ArbitrationStats.tsx。使用antd的Card和Statistic组件。显示仲裁统计信息：总信号数、APPROVED数量、REJECTED数量、批准率、各维度平均分数。使用useQuery调用GET /v1/arbitration/stats。
----[ ] NAME:2.5.12 在Dashboard中添加ArbitrationStats DESCRIPTION:编辑e:\projectBedrock\webapp\src\pages\Dashboard.tsx。在页面顶部添加ArbitrationStats组件，显示仲裁统计信息。添加“仲裁配置”按钮，点击后打开ArbitrationConfig弹窗。
----[ ] NAME:2.5.13 实现报告导出功能 DESCRIPTION:在BacktestResult组件中添加“导出PDF”和“导出JSON”按钮。参考2.md Phase 2功能点5优化增强（报告导出）。安装jspdf库。实现exportToPDF方法：生成包含所有绯效指标的PDF报告。实现exportToJSON方法：下载完整的report_data JSON文件。
----[ ] NAME:2.5.14 更新环境变量 DESCRIPTION:编辑e:\projectBedrock\webapp\.env.development。添加VITE_BACKTESTING_API_URL=http://localhost:8004。更新api.ts，支持多个服务的baseURL配置。
----[ ] NAME:2.5.15 重新构建并验证前端 DESCRIPTION:执行：docker-compose restart webapp。访问http://localhost:3000。验证SignalList显示ML和LLM分数。点击查看详情，验证SignalDetail弹窗显示仲裁详情。访问/backtest页面，测试创建回测任务。等待任务完成，查看报告。测试报告导出功能。验证仲裁配置管理功能。
----[ ] NAME:2.5.16 Phase 2技术债务清理 DESCRIPTION:在Phase 2完成后，进行技术债务清理。任务包括：1)ML模型优化：审查XGBoost模型性能，如果准确率<65%，重新进行特征工程和超参数调优。2)LLM Prompt优化：审查Qwen API调用的Prompt模板，优化Prompt以提高情绪分析准确率。3)回测引擎性能优化：使用profiler分析回测引擎性能瓶颈，优化慢速代码（如数据加载、指标计算）。4)Celery任务监控：添加Celery任务失败告警，记录任务执行时间分布。5)仲裁逻辑测试：补充仲裁逻辑的边界测试用例（如权重总和不等于1.0、min_approval_score边界值）。6)代码重构：提取BacktestingService和MLOpsService的共享逻辑（如Celery配置、数据库连接）。7)文档更新：更新ML_MODEL_FEATURES.md、ARBITRATION_ALGORITHM.md等文档。创建技术债务清单文件e:\projectBedrock\docs\TECH_DEBT_PHASE2.md。验证：所有AI功能正常工作，回测性能满足要求（单次回测<5分钟）。
--[ ] NAME:Phase 3: 迈向自动化与生产 - 完善生态系统 (5-7周) DESCRIPTION:参考2.md第三部分Phase 3。目标：建立模型的自我优化闭环，实现系统状态的实时推送，并完成生产化部署的准备工作。关键交付物：自动化的模型训练和版本管理、实时通知系统（WebSocket）、参数自我优化功能、完整的Kubernetes部署配置、CI/CD流水线。
---[ ] NAME:3.1 ML模型自动化 (MLOpsService) DESCRIPTION:参考2.md Phase 3功能点1。创建服务骨架集成Celery，开发Celery任务用于模型重训练，实现模型版本管理和注册表功能，创建MLModel数据库模型，实现/models API端点，配置Celery Worker，实现训练数据版本管理、超参数调优、模型A/B测试。
----[ ] NAME:3.1.1 创建MLOpsService目录结构 DESCRIPTION:在services/目录创建文件夹e:\projectBedrock\services\mlops。创建子目录：app/, app/core/, app/api/, app/models/, app/tasks/, app/services/, tests/。
----[ ] NAME:3.1.2 创建MLOpsService基础文件 DESCRIPTION:创建Dockerfile, requirements.txt（包含fastapi, sqlalchemy, redis, celery==5.3.4, mlflow==2.9.0, optuna==3.4.0, scikit-learn, xgboost, pandas, numpy）。创建alembic配置。创建app/core/config.py, app/core/database.py, app/core/redis.py, app/core/celery_app.py。
----[ ] NAME:3.1.3 设计MLModel数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\models\ml_model.py。参考2.md Phase 3功能点1。字段包括：id, model_name, model_version, model_type, model_path, metrics(JSONB), hyperparameters(JSONB), training_data_version, status(TRAINING/READY/DEPLOYED/ARCHIVED), created_at, deployed_at。添加索引。
----[ ] NAME:3.1.4 设计TrainingJob数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\models\training_job.py。字段包括：id, job_name, model_type, hyperparameters(JSONB), status(PENDING/RUNNING/COMPLETED/FAILED), celery_task_id, result_model_id, created_at, completed_at, error_message。添加索引。
----[ ] NAME:3.1.5 创建数据库迁移 DESCRIPTION:执行：alembic revision --autogenerate -m "Create ml_models and training_jobs tables"。检查迁移文件。执行：alembic upgrade head。
----[ ] NAME:3.1.6 配置MLflow DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\core\mlflow_config.py。参考2.md Phase 3功能点1优化增强（MLflow集成）。配置MLflow tracking URI（使用本地文件系统或远程服务器）。初始化MLflow client。实现log_model, log_metrics, log_params方法。
----[ ] NAME:3.1.7 实现训练数据版本管理 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\services\data_versioning.py。参考2.md Phase 3功能点1优化增强（训练数据版本管理）。实现DataVersionManager类。实现create_data_snapshot方法：从数据库导出训练数据，生成版本号（如v1.0.0），保存为Parquet文件。实现load_data_version方法：加载指定版本的数据。
----[ ] NAME:3.1.8 实现超参数调优 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\services\hyperparameter_tuning.py。参考2.md Phase 3功能点1优化增强（超参数调优）。使用Optuna库。实现HyperparameterTuner类。实现optimize方法：定义超参数搜索空间，使用Optuna进行贝叶斯优化，返回最佳超参数。
----[ ] NAME:3.1.9 实现模型训练逻辑 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\services\model_trainer.py。实现ModelTrainer类。实现train方法：1)加载训练数据。2)划分训练集/验证集/测试集。3)训练模型。4)计算性能指标。5)使用MLflow记录模型、指标、参数。6)保存模型文件。7)创建MLModel记录。
----[ ] NAME:3.1.10 创建Celery训练任务 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\tasks\training_task.py。定义Celery任务run_training。参数：job_id, model_type, hyperparameters, data_version。任务流程：1)更新TrainingJob状态为RUNNING。2)调用ModelTrainer.train执行训练。3)更新TrainingJob状态为COMPLETED，记录result_model_id。4)异常处理。
----[ ] NAME:3.1.11 实现模型注册表 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\services\model_registry.py。参考2.md Phase 3功能点1。实现ModelRegistry类。实现register_model方法：注册新模型。实现get_latest_model方法：获取最新版本的模型。实现deploy_model方法：将模型标记为DEPLOYED状态。实现archive_model方法：归档旧模型。
----[ ] NAME:3.1.12 实现模型A/B测试 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\services\ab_testing.py。参考2.md Phase 3功能点1优化增强（模型A/B测试）。实现ABTestManager类。实现create_ab_test方法：创建A/B测试，指定两个模型版本和流量分配比例。实现route_prediction方法：根据流量分配选择模型。实现collect_metrics方法：收集两个模型的性能指标。
----[ ] NAME:3.1.13 实现POST /v1/training/jobs端点 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\api\training.py。实现POST /v1/training/jobs端点。接收参数：job_name, model_type, hyperparameters, data_version。创建TrainingJob记录。调用Celery任务run_training.delay()。返回job_id。
----[ ] NAME:3.1.14 实现GET /v1/training/jobs/{job_id}端点 DESCRIPTION:在training.py中实现GET /v1/training/jobs/{job_id}端点。查询TrainingJob状态。返回job信息和进度。
----[ ] NAME:3.1.15 实现GET /v1/models端点 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\api\models.py。实现GET /v1/models端点。支持分页和过滤（model_type, status）。返回模型列表。
----[ ] NAME:3.1.16 实现POST /v1/models/{model_id}/deploy端点 DESCRIPTION:在models.py中实现POST /v1/models/{model_id}/deploy端点。调用ModelRegistry.deploy_model。更新DecisionEngineService使用新模型（通过事件或API调用）。
----[ ] NAME:3.1.17 实现健康检查和metrics DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\api\health.py和metrics.py。实现/health, /ready, /metrics端点。/ready检查数据库、Redis、Celery Worker、MLflow可用性。
----[ ] NAME:3.1.18 创建MLOpsService主应用 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\app\main.py。初始化FastAPI应用。注册路由。配置中间件。
----[ ] NAME:3.1.19 更新docker-compose.yml添加MLOpsService DESCRIPTION:编辑docker-compose.yml。添加mlops服务，映射端口8005:8005。添加mlops_celery_worker服务（运行celery -A app.core.celery_app worker --concurrency=2）。配置Celery Worker资源限制：deploy.resources.limits.cpus='4.0', deploy.resources.limits.memory='4g', deploy.resources.reservations.cpus='2.0', deploy.resources.reservations.memory='2g'（ML训练任务需要更多资源）。配置depends_on。添加healthcheck。在Kubernetes配置中为mlops_celery_worker添加HPA：基于CPU使用率自动扩缩（目标70%），最小副本数1，最大副本数5。验证：执行docker stats查看Celery Worker资源使用情况。
----[ ] NAME:3.1.20 编写MLOps测试 DESCRIPTION:创建文件e:\projectBedrock\services\mlops\tests\test_model_trainer.py。测试ModelTrainer.train方法。测试模型注册表功能。测试超参数调优。目标覆盖率>70%。
----[ ] NAME:3.1.21 启动并验证MLOpsService DESCRIPTION:执行：docker-compose up -d mlops mlops_celery_worker。访问http://localhost:8005/docs。测试POST /v1/training/jobs创建训练任务。等待任务完成，检查MLflow中的模型记录。测试GET /v1/models查询模型列表。测试POST /v1/models/{model_id}/deploy部署模型。
---[ ] NAME:3.2 实时通知网关 (NotificationService) DESCRIPTION:参考2.md Phase 3功能点2。创建服务骨架实现WebSocket连接管理，订阅Redis中SignalCreated和PortfolioUpdated事件，通过WebSocket实时推送给前端，实现WebSocket端点/ws/{client_id}，配置Redis连接池，实现健康检查和全局异常处理。
----[ ] NAME:3.2.1 创建NotificationService目录结构 DESCRIPTION:在services/目录创建文件夹e:\projectBedrock\services\notification。创建子目录：app/, app/core/, app/api/, app/services/, tests/。
----[ ] NAME:3.2.2 创建NotificationService基础文件 DESCRIPTION:创建Dockerfile, requirements.txt（包含fastapi, redis==5.0.1, websockets==12.0, structlog）。创建app/core/config.py, app/core/redis.py。
----[ ] NAME:3.2.3 实现WebSocket连接管理器 DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\services\connection_manager.py。参考2.md Phase 3功能点2。实现ConnectionManager类。维护活跃连接字典：{client_id: WebSocket}。实现connect方法：添加新连接。实现disconnect方法：移除连接。实现send_message方法：发送消息给指定客户端。实现broadcast方法：广播消息给所有连接。
----[ ] NAME:3.2.4 实现Redis事件订阅器 DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\services\event_subscriber.py。参考2.md Phase 3功能点2。实现EventSubscriber类。订阅Redis频道：signal.created, portfolio.updated。实现on_signal_created回调：解析事件数据，调用ConnectionManager.broadcast发送给所有客户端。实现on_portfolio_updated回调。实现start方法：在后台线程运行订阅器。
----[ ] NAME:3.2.5 实现WebSocket端点 DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\api\websocket.py。参考2.md Phase 3功能点2。实现WebSocket端点/ws/{client_id}。接受WebSocket连接，调用ConnectionManager.connect。保持连接活跃，处理客户端消息（如ping/pong）。连接断开时调用ConnectionManager.disconnect。
----[ ] NAME:3.2.6 实现心跳机制 DESCRIPTION:在websocket.py中实现心跳机制。参考2.md Phase 3功能点2优化增强（心跳机制）。服务端每30秒发送ping消息。客户端必须在10秒内回复pong。如果超时未回复，关闭连接。
----[ ] NAME:3.2.7 实现消息格式化 DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\services\message_formatter.py。实现MessageFormatter类。定义消息格式：{"type": "signal_created", "data": {...}, "timestamp": "..."}。实现format_signal_created方法。实现format_portfolio_updated方法。
----[ ] NAME:3.2.8 实现连接状态统计 DESCRIPTION:在ConnectionManager中添加统计功能。记录当前连接数、总连接数、总断开数、发送消息数。实现get_stats方法返回统计信息。
----[ ] NAME:3.2.9 实现GET /v1/stats端点 DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\api\stats.py。实现GET /v1/stats端点。调用ConnectionManager.get_stats返回连接统计信息。
----[ ] NAME:3.2.10 实现健康检查和metrics DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\api\health.py和metrics.py。实现/health, /ready, /metrics端点。/ready检查Redis连接。/metrics暴露WebSocket连接数、消息发送数等指标。
----[ ] NAME:3.2.11 创建NotificationService主应用 DESCRIPTION:创建文件e:\projectBedrock\services\notification\app\main.py。初始化FastAPI应用。注册WebSocket路由和HTTP路由。配置中间件。启动时初始化EventSubscriber（在后台线程运行）。
----[ ] NAME:3.2.12 更新docker-compose.yml添加NotificationService DESCRIPTION:编辑docker-compose.yml。添加notification服务，映射端口8006:8006。配置depends_on（redis）。添加healthcheck。
----[ ] NAME:3.2.13 编写WebSocket测试 DESCRIPTION:创建文件e:\projectBedrock\services\notification\tests\test_websocket.py。测试WebSocket连接、断开、消息发送。测试心跳机制。测试事件订阅和广播。目标覆盖率>70%。
----[ ] NAME:3.2.14 启动并验证NotificationService DESCRIPTION:执行：docker-compose up -d notification。访问http://localhost:8006/docs。使用WebSocket客户端连接ws://localhost:8006/ws/test_client。触发一个信号生成，验证WebSocket客户端接收到signal_created消息。测试GET /v1/stats查看连接统计。
---[ ] NAME:3.3 自我调优逻辑 DESCRIPTION:参考2.md Phase 3功能点3。在BacktestingService中增加参数寻优功能（网格搜索、贝叶斯优化），设计逻辑根据回测绩效调整决策仲裁权重，实现/optimize API端点，集成优化结果到DecisionEngineService。
----[ ] NAME:3.3.1 设计参数优化算法 DESCRIPTION:创建文件e:\projectBedrock\docs\PARAMETER_OPTIMIZATION.md。参考2.md Phase 3功能点3。设计优化算法：基于回测绯效调整仲裁权重。定义优化目标：最大化Sharpe Ratio或总收益率。定义约束条件：权重总和=1.0，每个权重≥0。
----[ ] NAME:3.3.2 在BacktestingService中添加网格搜索 DESCRIPTION:编辑e:\projectBedrock\services\backtesting\app\services\parameter_optimizer.py。参考2.md Phase 3功能点3。实现GridSearchOptimizer类。实现optimize方法：定义参数网格（如rule_weight: [0.2, 0.3, 0.4, 0.5], ml_weight: [0.2, 0.3, 0.4], llm_weight: [0.2, 0.3, 0.4]）。遍历所有组合，执行回测，记录绯效。返回最佳参数组合。
----[ ] NAME:3.3.3 在BacktestingService中添加贝叶斯优化 DESCRIPTION:在parameter_optimizer.py中实现BayesianOptimizer类。使用Optuna库。实现optimize方法：定义目标函数（执行回测，返回Sharpe Ratio）。使用Optuna进行贝叶斯优化，搜索最佳参数。返回最佳参数组合。
----[ ] NAME:3.3.4 实现POST /v1/optimize端点 DESCRIPTION:编辑e:\projectBedrock\services\backtesting\app\api\backtest.py。实现POST /v1/optimize端点。接收参数：optimization_method(grid_search/bayesian), start_date, end_date, n_trials(仅贝叶斯优化)。调用相应的优化器。返回最佳参数和绯效。
----[ ] NAME:3.3.5 实现自动应用优化结果 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\services\auto_apply.py。实现AutoApply类。实现apply_optimized_params方法：调用DecisionEngineService的PUT /v1/arbitration/config端点，更新仲裁配置。记录优化历史。
----[ ] NAME:3.3.6 创建OptimizationHistory数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\app\models\optimization_history.py。字段包括：id, optimization_method, best_params(JSONB), best_metrics(JSONB), applied, created_at, applied_at。创建数据库迁移并执行。
----[ ] NAME:3.3.7 实现GET /v1/optimize/history端点 DESCRIPTION:在backtest.py中实现GET /v1/optimize/history端点。返回优化历史记录。支持分页。
----[ ] NAME:3.3.8 编写参数优化测试 DESCRIPTION:创建文件e:\projectBedrock\services\backtesting\tests\test_parameter_optimizer.py。测试GridSearchOptimizer和BayesianOptimizer。测试优化结果的正确性。目标覆盖率>70%。
----[ ] NAME:3.3.9 验证自我调优功能 DESCRIPTION:重启BacktestingService。测试POST /v1/optimize创建优化任务。等待优化完成，查看最佳参数。测试自动应用功能，验证DecisionEngineService的仲裁配置已更新。测试GET /v1/optimize/history查看优化历史。
---[ ] NAME:3.4 生产化部署 DESCRIPTION:参考2.md Phase 3功能点4。为每个服务编写Kubernetes部署文件(YAML)，创建PostgreSQL StatefulSet和Redis Deployment，创建所有服务的Deployment和Service，创建ConfigMap和Secret，创建Ingress配置，配置GitHub Actions自动构建Docker镜像，创建Kustomization文件，实现密钥轮换、HPA配置、PDB配置。
----[ ] NAME:3.4.1 创建Kubernetes配置文件目录 DESCRIPTION:创建目录e:\projectBedrock\k8s。创建子目录：base/, overlays/dev/, overlays/prod/。参考2.md Phase 3功能点4。
----[ ] NAME:3.4.2 编写数据库Deployment和Service DESCRIPTION:创建文件e:\projectBedrock\k8s\base\postgres-deployment.yaml。定义PostgreSQL Deployment和Service。使用PersistentVolumeClaim持久化数据。配置环境变量。
----[ ] NAME:3.4.3 编写RedisDeployment和Service DESCRIPTION:创建文件e:\projectBedrock\k8s\base\redis-deployment.yaml。定义Redis Deployment和Service。配置持久化存储。
----[ ] NAME:3.4.4 编写微服务Deployment和Service DESCRIPTION:创建文件：datahub-deployment.yaml, decision-engine-deployment.yaml, portfolio-deployment.yaml, backtesting-deployment.yaml, mlops-deployment.yaml, notification-deployment.yaml。每个文件包含Deployment和Service定义。配置资源限制（requests/limits）。配置健康检查（livenessProbe/readinessProbe）。
----[ ] NAME:3.4.5 编写Ingress配置 DESCRIPTION:创建文件e:\projectBedrock\k8s\base\ingress.yaml。配置路由规则：/api/datahub -> datahub:8001, /api/decision -> decision-engine:8002, /api/portfolio -> portfolio:8003, /api/backtest -> backtesting:8004, /api/mlops -> mlops:8005, /ws -> notification:8006。配置TLS（可选）。
----[ ] NAME:3.4.6 创建ConfigMap和Secret DESCRIPTION:创建文件e:\projectBedrock\k8s\base\configmap.yaml。存储非敏感配置。创建文件e:\projectBedrock\k8s\overlays\prod\secret.yaml。存储敏感信息（数据库密码、API Keys）。使用base64编码。
----[ ] NAME:3.4.7 配置HorizontalPodAutoscaler DESCRIPTION:创建文件e:\projectBedrock\k8s\base\hpa.yaml。参考2.md Phase 3功能点4优化增强（水平扩展）。为DecisionEngineService和DataHubService配置HPA。基于CPU使用率自动扩缩（目标：70%）。最小副本数：2，最大副本数：10。
----[ ] NAME:3.4.8 配置Prometheus和Grafana DESCRIPTION:创建文件e:\projectBedrock\k8s\base\monitoring.yaml。参考2.md Phase 3功能点4优化增强（Prometheus/Grafana）。部署Prometheus收集指标。部署Grafana可视化。配置 ServiceMonitor监控所有微服务。
----[ ] NAME:3.4.9 编写部署脚本 DESCRIPTION:创建文件e:\projectBedrock\scripts\deploy.ps1。参考2.md Phase 3功能点4。脚本功能：1)构建Docker镜像。2)推送到镜像仓库。3)应用Kubernetes配置。4)等待所有Pod就绪。5)验证部署状态。
----[ ] NAME:3.4.10 测试Kubernetes部署 DESCRIPTION:在本地Kubernetes集群（如Minikube或Docker Desktop）测试部署。执行kubectl apply -k k8s/overlays/dev。检查所有Pod状态。测试服务访问。验证HPA功能。验证Prometheus和Grafana。
----[ ] NAME:3.4.11 配置GitHub Actions CI/CD Pipeline DESCRIPTION:创建文件e:\projectBedrock\.github\workflows\ci.yml。参考2.md Phase 3功能点4和Phase 4.4.19。CI流程：1)代码检查（black, isort, flake8, mypy, ESLint, Prettier）。2)单元测试（pytest --cov, Jest）。3)安全扫描（safety, npm audit, Trivy）。4)构建Docker镜像（所有服务）。5)推送到GitHub Container Registry (GHCR)。CD流程：1)部署到测试环境（自动触发）。2)运行集成测试。3)部署到生产环境（需要手动批准）。配置触发条件：push到main分支、pull request。配置secrets：GHCR_TOKEN, KUBE_CONFIG_STAGING, KUBE_CONFIG_PROD。验证：提交代码后检查GitHub Actions运行状态。
---[ ] NAME:3.5 前端实时化 DESCRIPTION:参考2.md Phase 3功能点5。集成WebSocket客户端监听NotificationService消息，将仪表盘上的信号和仓位展示从轮询改为实时更新，创建WebSocket服务封装，创建WebSocket Context，实现实时信号通知、仓位更新、统计指标更新，实现连接状态指示器和自动重连机制。
----[ ] NAME:3.5.1 安装WebSocket客户端库 DESCRIPTION:在webapp目录执行：npm install socket.io-client。参考2.md Phase 3功能点5。
----[ ] NAME:3.5.2 创建WebSocket服务 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\services\websocketService.ts。实现WebSocketService类。实现connect方法：连接到ws://localhost:8006/ws/{client_id}。实现disconnect方法。实现on方法：注册事件监听器。实现自动重连机制。
----[ ] NAME:3.5.3 创建useWebSocket Hook DESCRIPTION:创建文件e:\projectBedrock\webapp\src\hooks\useWebSocket.ts。实现useWebSocket自定义Hook。返回：isConnected, lastMessage, sendMessage。在组件挂载时自动连接，卸载时自动断开。
----[ ] NAME:3.5.4 在Dashboard中集成WebSocket DESCRIPTION:编辑e:\projectBedrock\webapp\src\pages\Dashboard.tsx。使用useWebSocket Hook。监听signal_created事件，实时更新SignalList。监听portfolio_updated事件，实时更新PortfolioSummary。显示WebSocket连接状态指示器。
----[ ] NAME:3.5.5 实现实时通知Toast DESCRIPTION:在Dashboard中添加Toast通知。当接收到signal_created事件时，显示Toast通知：“新信号：{market} {signal_type}”。使用antd的message组件。
----[ ] NAME:3.5.6 实现实时图表更新 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\RealTimeChart.tsx。使用ECharts或Recharts。显示实时资产曲线。监听portfolio_updated事件，动态更新图表数据。
----[ ] NAME:3.5.7 在Dashboard中添加RealTimeChart DESCRIPTION:编辑Dashboard.tsx。在页面中添加RealTimeChart组件。显示实时资产变化。
----[ ] NAME:3.5.8 实现连接状态指示器 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\ConnectionStatus.tsx。显示WebSocket连接状态：已连接(绿色)、断开(红色)、重连中(黄色)。使用antd的Badge组件。
----[ ] NAME:3.5.9 更新环境变量 DESCRIPTION:编辑e:\projectBedrock\webapp\.env.development。添加VITE_WS_URL=ws://localhost:8006。更新websocketService.ts使用环境变量。
----[ ] NAME:3.5.10 验证实时功能 DESCRIPTION:重启webapp和notification服务。访问http://localhost:3000。验证WebSocket连接状态显示为“已连接”。触发一个信号生成，验证：1)SignalList实时更新。2)Toast通知弹出。触发仓位更新，验证RealTimeChart实时更新。
---[ ] NAME:3.6 低优先级优化 DESCRIPTION:参考2.md Phase 3低优先级任务。包括WebSocket心跳机制优化、API响应时间分布监控。这些是可选的优化功能，可在核心功能完成后实施。
----[ ] NAME:3.6.1 实现WebSocket心跳机制优化 DESCRIPTION:参考2.md第四部分30 WebSocket心跳机制。服务端每30秒发送ping消息。客户端收到ping后立即响应pong。服务端记录最后一次pong时间，超过90秒未响应则关闭连接。前端实现自动重连逻辑：连接断开后每5秒尝试重连，最多重试10次。在前端显示连接状态（已连接/断开/重连中）。验证：断开网络后观察自动重连行为。
----[ ] NAME:3.6.2 实现API响应时间分布监控 DESCRIPTION:参考2.md第四部分27 API响应时间分布监控。使用Prometheus Histogram记录API响应时间分布。记录P50/P95/P99百分位数据。在Grafana中可视化响应时间分布。配置告警规则：P95响应时间 > 5秒时触发告警。在所有服务的请求中间件中添加响应时间记录。验证：在Grafana中查看API响应时间分布图表。
----[ ] NAME:3.6.3 Phase 3技术债务清理 DESCRIPTION:在Phase 3完成后，进行技术债务清理。任务包括：1)MLOps流程优化：审查模型训练流程，优化训练数据加载速度，添加训练进度监控。2)WebSocket稳定性测试：进行WebSocket压力测试（1000并发连接），验证连接管理器的稳定性。3)Kubernetes配置审查：审查所有K8s配置文件，确保资源限制合理（CPU、内存），添加缺失的livenessProbe和readinessProbe。4)CI/CD流程优化：优化GitHub Actions流程，添加缓存以加速构建，添加并行测试以缩短CI时间。5)参数优化逻辑测试：补充参数优化逻辑的测试用例，验证网格搜索和贝叶斯优化的正确性。6)监控告警测试：触发各种告警场景（CPU高、内存高、服务宕机），验证告警正常发送。7)文档更新：更新OPERATIONS_GUIDE.md、DEPLOYMENT_ENVIRONMENTS.md等运维文档。创建技术债务清单文件e:\projectBedrock\docs\TECH_DEBT_PHASE3.md。验证：所有生产化功能正常工作，K8s部署稳定，CI/CD流程顺畅。
--[ ] NAME:Phase 4: 扩展与生态 - 增强平台能力 (持续进行) DESCRIPTION:参考2.md第三部分Phase 4。目标：在稳固的平台上不断扩展功能边界，提升平台的深度和广度。关键交付物：多数据源支持（链上数据、多交易所）、高级可视化、深度LLM应用、完整的监控和告警系统、生产级别的安全加固。注意：此阶段为可选高级功能。
---[ ] NAME:4.1 扩展数据源 DESCRIPTION:参考2.md Phase 4功能点1。扩展链上数据功能（添加更多数据源、优化查询性能），实现BybitAdapter或其他交易所适配器，将新数据源整合进DecisionEngineService的决策流程。注意：Phase 1已实现基础链上数据功能（任务1.1.28.1-1.1.28.7），本阶段专注于扩展和优化。
----[ ] NAME:4.1.1 定义MultiExchangeInterface抽象接口 DESCRIPTION:编辑e:\projectBedrock\services\datahub\app\adapters\exchange_interface.py。扩展ExchangeInterface接口，确保支持多交易所。定义统一的数据格式。
----[ ] NAME:4.1.2 实现BybitAdapter DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\adapters\bybit_adapter.py。实现ExchangeInterface接口。使用pybit库（pip install pybit）。实现get_klines方法。实现速率限制和重试机制。配置Bybit API Key环境变量。
----[ ] NAME:4.1.3 实现交易所路由逻辑 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\app\services\exchange_router.py。实现ExchangeRouter类。根据symbol和exchange参数路由到正确的适配器（BinanceAdapter或BybitAdapter）。实现get_klines方法：自动选择交易所适配器。
----[ ] NAME:4.1.4 更新/klines端点支持多交易所 DESCRIPTION:编辑e:\projectBedrock\services\datahub\app\api\klines.py。添加exchange查询参数（默认binance）。使用ExchangeRouter代替直接调用BinanceAdapter。更新缓存键格式：klines:{exchange}:{symbol}:{interval}:{limit}。
----[ ] NAME:4.1.5 扩展链上数据功能 DESCRIPTION:编辑e:\projectBedrock\services\datahub\app\adapters\bitquery_adapter.py。添加更多链上数据查询方法：get_dex_trades（获取DEX交易数据）、get_token_holders（获取代币持有者分布）、get_gas_price_trends（获取Gas价格趋势）。优化GraphQL查询性能。添加批量查询支持。
----[ ] NAME:4.1.6 优化链上数据缓存策略 DESCRIPTION:编辑e:\projectBedrock\services\datahub\app\api\chain_data.py。实现多级缓存：L1缓存（Redis，5分钟）、L2缓存（数据库，1小时）。实现缓存预热机制：定时任务预加载热门市场的链上数据。实现缓存失效策略：当检测到大额转账时主动失效相关缓存。
----[ ] NAME:4.1.7 在DecisionEngine中优化链上数据集成 DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\app\engines\rule_engine.py。优化链上数据调用逻辑：使用异步并发调用多个链上数据端点。实现链上数据权重动态调整：根据历史准确率调整链上信号权重。添加链上数据异常检测：识别异常的链上活动模式。
----[ ] NAME:4.1.8 更新ML模型特征 DESCRIPTION:编辑e:\projectBedrock\services\decision_engine\scripts\prepare_training_data.py。添加链上数据特征：24小时大额转账次数、聪明钱净流入/流出、DEX交易量、代币持有者集中度、Gas价格趋势。更新e:\projectBedrock\docs\ML_MODEL_FEATURES.md文档。
----[ ] NAME:4.1.9 编写扩展功能测试 DESCRIPTION:创建文件e:\projectBedrock\services\datahub\tests\test_bybit_adapter.py。测试BybitAdapter的所有方法。测试ExchangeRouter的路由逻辑。测试扩展的链上数据功能。测试多级缓存策略。目标覆盖率>70%。
----[ ] NAME:4.1.10 重启并验证扩展数据源 DESCRIPTION:执行：docker-compose restart datahub decision_engine。测试GET /v1/chain-data获取扩展的链上数据。测试GET /v1/klines?exchange=bybit获取Bybit数据。触发信号生成，验证链上数据已优化集成到决策流程。检查日志确认多数据源正常工作。验证缓存命中率提升。
---[ ] NAME:4.2 高级可视化 DESCRIPTION:参考2.md Phase 4功能点2。引入ECharts图表库，开发交互式的净值曲线图、绩效分析雷达图，在回测报告中提供更详细的交易明细和统计分布图，创建净值曲线组件、绩效分析雷达图、交易分布热力图、回测对比图表、可视化页面。
----[ ] NAME:4.2.1 安装ECharts库 DESCRIPTION:在webapp目录执行：npm install echarts echarts-for-react。参考2.md Phase 4功能点2。
----[ ] NAME:4.2.2 创建NetWorthCurve组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\NetWorthCurve.tsx。参考2.md Phase 4功能点2。使用ECharts绘制交互式净值曲线图。显示账户总资产随时间变化。支持缩放、平移、数据点悬停显示。添加基准线（初始资产）。添加最大回撤区域阴影。
----[ ] NAME:4.2.3 创建PerformanceRadar组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\PerformanceRadar.tsx。参考2.md Phase 4功能点2。使用ECharts雷达图。显示多维度绯效分析：总收益率、夏普比率、最大回撤、胜率、利润因子、卡玛比率。支持多个策略对比（叠加显示）。
----[ ] NAME:4.2.4 创建TradeDistribution组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\TradeDistribution.tsx。使用ECharts热力图。显示交易分布：X轴=时间（小时/星期），Y轴=市场，颜色深度=交易次数或盈亏。帮助识别最佳交易时段和市场。
----[ ] NAME:4.2.5 创建BacktestComparison组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\BacktestComparison.tsx。使用ECharts柱状图和折线图组合。支持多个回测结果对比。显示关键指标对比：总收益率、夏普比率、最大回撤、胜率。显示净值曲线对比。
----[ ] NAME:4.2.6 创建DrawdownChart组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\DrawdownChart.tsx。使用ECharts面积图。显示回撤曲线：当前回撤百分比随时间变化。标记最大回撤点。添加回撤阈值警告线。
----[ ] NAME:4.2.7 创建SignalAnalysis组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\SignalAnalysis.tsx。使用ECharts饼图和条形图。显示信号分布：按signal_type分类的信号数量。显示信号批准率：APPROVED vs REJECTED。显示各维度平均分数（rule, ml, llm）。
----[ ] NAME:4.2.8 增强回测报告详情 DESCRIPTION:编辑e:\projectBedrock\webapp\src\components\BacktestResult.tsx。集成NetWorthCurve组件显示净值曲线。集成DrawdownChart组件显示回撤分析。集成TradeDistribution组件显示交易分布。添加交易明细表格（所有交易记录）。
----[ ] NAME:4.2.9 创建Visualization页面 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\pages\Visualization.tsx。参考2.md Phase 4功能点2。使用antd的Layout组件。左侧侧边栏：选择图表类型和策略。右侧主区域：显示选中的图表。支持图表导出（PNG/SVG）。
----[ ] NAME:4.2.10 实现图表数据服务 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\services\chartService.ts。实现getNetWorthData方法：从/v1/stats获取历史资产数据。实现getPerformanceData方法：从/v1/backtest/reports获取绯效数据。实现getTradeDistributionData方法：从/v1/trades获取交易分布数据。
----[ ] NAME:4.2.11 更新路由配置 DESCRIPTION:编辑e:\projectBedrock\webapp\src\router.tsx。添加路由：/visualization -> Visualization页面。更新导航菜单，添加“可视化”菜单项。
----[ ] NAME:4.2.12 实现图表主题配置 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\config\chartTheme.ts。定义ECharts主题配置：颜色方案、字体样式、网格线样式。支持亮色/暗色主题切换。
----[ ] NAME:4.2.13 实现图表导出功能 DESCRIPTION:在每个图表组件中添加导出按钮。使用ECharts的getDataURL API导出PNG。使用ECharts的renderToSVGString API导出SVG。实现下载功能。
----[ ] NAME:4.2.14 编写图表组件测试 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\charts\__tests__\NetWorthCurve.test.tsx。测试图表渲染。测试数据更新。测试交互功能。目标覆盖率>70%。
----[ ] NAME:4.2.15 验证高级可视化功能 DESCRIPTION:重启webapp。访问/visualization页面。验证所有图表组件正常显示。测试图表交互功能（缩放、悬停、切换）。测试图表导出功能。验证回测报告中的详细图表。
---[ ] NAME:4.3 深度LLM应用 DESCRIPTION:参考2.md Phase 4功能点3。利用LLM为每一笔交易自动生成自然语言的交易日志或复盘备忘录，探索使用LLM进行更复杂的基本面分析，设计交易日志生成Prompt，实现交易日志生成服务，设计复盘备忘录Prompt，实现复盘备忘录生成服务，探索基本面分析，实现/journal和/review API端点，创建前端日志页面和复盘页面。
----[ ] NAME:4.3.1 设计交易日志Prompt模板 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\prompts\trade_journal.txt。参考2.md Phase 4功能点3。设计Prompt模板，输入：交易详情（市场、价格、时间、盈亏）、信号信息、市场环境。要求LLM输出：交易总结、执行评价、关键学习点、改进建议。
----[ ] NAME:4.3.2 实现TradeJournalGenerator服务 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\services\trade_journal_generator.py。实现TradeJournalGenerator类。实现generate方法：加载Prompt模板，填充交易数据，调用QwenAdapter生成日志，返回结构化结果。实现缓存机制（缓存键：trade:journal:{trade_id}）。
----[ ] NAME:4.3.3 创建TradeJournal数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\models\trade_journal.py。字段包括：id, trade_id, summary(TEXT), execution_evaluation(TEXT), key_learnings(TEXT), improvement_suggestions(TEXT), generated_at。添加索引。创建数据库迁移并执行。
----[ ] NAME:4.3.4 实现POST /v1/trades/{trade_id}/journal端点 DESCRIPTION:编辑e:\projectBedrock\services\portfolio\app\api\trades.py。实现POST /v1/trades/{trade_id}/journal端点。查询Trade记录。调用DecisionEngineService的TradeJournalGenerator生成日志。保存TradeJournal记录。返回生成的日志。
----[ ] NAME:4.3.5 实现GET /v1/trades/{trade_id}/journal端点 DESCRIPTION:在trades.py中实现GET /v1/trades/{trade_id}/journal端点。查询TradeJournal记录。返回交易日志。
----[ ] NAME:4.3.6 设计复盘备忘录Prompt模板 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\prompts\review_memo.txt。设计Prompt模板，输入：时间范围内的所有交易、综合绯效指标、市场环境变化。要求LLM输出：阶段性总结、成功交易分析、失败交易分析、策略优化建议、下一阶段行动计划。
----[ ] NAME:4.3.7 实现ReviewMemoGenerator服务 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\app\services\review_memo_generator.py。实现ReviewMemoGenerator类。实现generate方法：从数据库聚合指定时间范围的交易数据，调用QwenAdapter生成复盘备忘录，返回结构化结果。
----[ ] NAME:4.3.8 创建ReviewMemo数据模型 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\models\review_memo.py。字段包括：id, period_start, period_end, summary(TEXT), successful_trades_analysis(TEXT), failed_trades_analysis(TEXT), strategy_optimization(TEXT), action_plan(TEXT), generated_at。添加索引。创建数据库迁移并执行。
----[ ] NAME:4.3.9 实现POST /v1/reviews端点 DESCRIPTION:创建文件e:\projectBedrock\services\portfolio\app\api\reviews.py。实现POST /v1/reviews端点。接收参数：period_start, period_end。调用DecisionEngineService的ReviewMemoGenerator生成复盘备忘录。保存ReviewMemo记录。返回生成的备忘录。
----[ ] NAME:4.3.10 实现GET /v1/reviews端点 DESCRIPTION:在reviews.py中实现GET /v1/reviews端点。支持分页和时间范围过滤。返回ReviewMemo列表。
----[ ] NAME:4.3.11 探索LLM基本面分析 DESCRIPTION:创建文件e:\projectBedrock\docs\LLM_FUNDAMENTAL_ANALYSIS.md。参考2.md Phase 4功能点3。研究如何使用LLM进行基本面分析。设计Prompt模板：输入项目白皮书、团队信息、社区活跃度、代币经济模型。要求LLM输出：项目评估、风险评级、投资建议。记录研究结果和实现计划。
----[ ] NAME:4.3.12 创建TradeJournal前端组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\TradeJournal.tsx。使用antd的Card组件。显示交易日志内容：总结、执行评价、关键学习点、改进建议。添加“生成日志”按钮。
----[ ] NAME:4.3.13 创建ReviewMemo前端组件 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\components\ReviewMemo.tsx。使用antd的Card和Timeline组件。显示复盘备忘录内容：阶段性总结、成功/失败交易分析、策略优化建议、行动计划。添加“生成复盘”按钮。
----[ ] NAME:4.3.14 创建Journal页面 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\pages\Journal.tsx。显示所有交易列表。点击交易后显示TradeJournal组件。支持按时间、市场过滤。
----[ ] NAME:4.3.15 创建Review页面 DESCRIPTION:创建文件e:\projectBedrock\webapp\src\pages\Review.tsx。显示所有复盘备忘录列表。点击后显示ReviewMemo组件。添加“新建复盘”按钮，选择时间范围后生成。
----[ ] NAME:4.3.16 更新路由配置 DESCRIPTION:编辑e:\projectBedrock\webapp\src\router.tsx。添加路由：/journal -> Journal页面，/review -> Review页面。更新导航菜单，添加“交易日志”和“复盘备忘录”菜单项。
----[ ] NAME:4.3.17 编写LLM应用测试 DESCRIPTION:创建文件e:\projectBedrock\services\decision_engine\tests\test_trade_journal_generator.py。测试TradeJournalGenerator和ReviewMemoGenerator。使用mock模拟Qwen API响应。测试Prompt模板填充逻辑。目标覆盖率>70%。
----[ ] NAME:4.3.18 验证深度LLM应用 DESCRIPTION:重启decision_engine和portfolio服务。测试POST /v1/trades/{trade_id}/journal生成交易日志。测试POST /v1/reviews生成复盘备忘录。访问/journal和/review页面，验证前端显示。检查生成的内容质量和可读性。
---[ ] NAME:4.4 平台健壮性 DESCRIPTION:参考2.md Phase 4功能点4。完善单元测试和集成测试（目标覆盖率>80%），引入监控和告警系统（Prometheus, Grafana），持续的性能优化和安全加固。包括：Prometheus监控、自定义业务指标、Grafana可视化、Grafana告警、结构化日志、性能优化、安全认证、RBAC、加密、漏洞扫描、备份策略、恢复策略、灾难恢复计划、错误日志聚合、API分页、前端代码分割、API文档、CI/CD Pipeline、运维文档、全面系统测试。
----[ ] NAME:4.4.1 配置Prometheus监控 DESCRIPTION:编辑e:\projectBedrock\k8s\base\monitoring.yaml。参考2.md Phase 4功能点4。配置Prometheus Deployment和Service。配置ServiceMonitor监控所有微服务的/metrics端点。配置数据保留策略（15天）。
----[ ] NAME:4.4.2 添加自定义业务指标 DESCRIPTION:在所有服务的/metrics端点中添加自定义业务指标。参考2.md第四部分8监控指标。示例：signal_generated_total, signal_approved_total, position_opened_total, trade_pnl_total, backtest_completed_total, model_training_duration_seconds。使用prometheus-client库的Counter, Gauge, Histogram。
----[ ] NAME:4.4.3 配置Grafana可视化 DESCRIPTION:在monitoring.yaml中添加Grafana Deployment和Service。配置Grafana数据源连接Prometheus。创建文件e:\projectBedrock\k8s\base\grafana-dashboards.json。设计Dashboard显示：系统指标（CPU、内存、网络）、业务指标（信号数、交易数、盈亏）、服务健康状态。
----[ ] NAME:4.4.4 配置Grafana告警 DESCRIPTION:创建文件e:\projectBedrock\k8s\base\grafana-alerts.yaml。参考2.md Phase 4功能点4。配置告警规则：1)服务宕机（健康检查失败>5分钟）。2)CPU使用率>80%。3)内存使用率>85%。4)错误率>5%。5)响应时间>2s。6)数据库连接池耗尽。配置通知渠道（Email/Slack/Webhook）。
----[ ] NAME:4.4.5 实现结构化日志 DESCRIPTION:在所有服务中使用structlog库实现结构化日志。参考2.md第四部分22请求日志中间件。日志格式：JSON。必须字段：timestamp, level, service_name, request_id, message。可选字段：user_id, endpoint, method, status_code, duration_ms, error_type。输出到stdout，由Kubernetes收集。
----[ ] NAME:4.4.6 性能优化 - 数据库查询 DESCRIPTION:审查所有数据库查询，添加必要的索引。参考2.md第四部分11数据库索引策略。使用EXPLAIN ANALYZE分析慢查询。优化N+1查询问题（使用joinedload）。对高频查询实现物化视图。记录优化结果到e:\projectBedrock\docs\PERFORMANCE_OPTIMIZATION.md。
----[ ] NAME:4.4.7 性能优化 - 缓存策略 DESCRIPTION:审查所有Redis缓存使用。参考2.md第四部分13 Redis连接池配置。实现缓存预热（服务启动时加载热点数据）。实现缓存穿透防护（布隆过滤器）。实现缓存雪崩防护（随机过期时间）。监控缓存命中率。
----[ ] NAME:4.4.8 安全加固 - API认证 DESCRIPTION:实现JWT认证机制。参考2.md第四部分20 API认证与授权。创建文件e:\projectBedrock\services\auth\app\core\jwt.py。实现create_access_token, verify_token方法。配置JWT_SECRET_KEY环境变量。在所有API端点添加@require_auth装饰器。实现/v1/auth/login和/v1/auth/refresh端点。
----[ ] NAME:4.4.9 安全加固 - RBAC权限控制 DESCRIPTION:实现基于角色的访问控制。创建文件e:\projectBedrock\services\auth\app\models\user.py和role.py。定义角色：admin, trader, viewer。定义权限：read:signals, write:signals, read:positions, write:positions, read:backtest, write:backtest, admin:all。实现@require_permission装饰器。在所有敏感操作添加权限检查。
----[ ] NAME:4.4.10 安全加固 - 数据加密 DESCRIPTION:实现敏感数据加密。参考2.md第四部分23敏感数据加密。使用cryptography库。创建文件e:\projectBedrock\services\common\encryption.py。实现encrypt, decrypt方法。加密API Keys存储到数据库。加密用户敏感信息。配置ENCRYPTION_KEY环境变量（使用Kubernetes Secret）。
----[ ] NAME:4.4.11 安全加固 - 漏洞扫描 DESCRIPTION:集成安全扫描工具。参考2.md Phase 4功能点4。Python依赖：使用safety扫描已知漏洞（pip install safety, safety check）。Node.js依赖：使用npm audit。Docker镜像：使用Trivy扫描（trivy image <image_name>）。将扫描集成到CI/CD流程。
----[ ] NAME:4.4.12 实现备份策略 DESCRIPTION:实现数据库备份。参考2.md Phase 4功能点4。创建文件e:\projectBedrock\scripts\backup_db.ps1（全量备份）和backup_db_incremental.ps1（增量备份）。使用pg_dump备份PostgreSQL。备份频率：每日凌晨2点全量备份，每小时增量备份（使用WAL归档）。保留策略：全量备份保留30天，增量备份保留7天。备份存储：云存储（AWS S3/Azure Blob）。实现备份加密（AES-256）。
----[ ] NAME:4.4.13 实现恢复策略 DESCRIPTION:实现数据库恢复。创建文件e:\projectBedrock\scripts\restore_db.ps1。使用pg_restore恢复PostgreSQL。实现恢复验证（每周测试一次恢复流程）。记录恢复流程到e:\projectBedrock\docs\DISASTER_RECOVERY.md。
----[ ] NAME:4.4.14 实现灾难恢复计划 DESCRIPTION:创建文件e:\projectBedrock\docs\DISASTER_RECOVERY_PLAN.md。参考2.md Phase 4功能点4。定义RTO（Recovery Time Objective）和RPO（Recovery Point Objective）。记录灾难场景：数据库崩溃、服务器故障、网络中断、数据损坏。记录恢复步骤和责任人。定期演练（每季度一次）。
----[ ] NAME:4.4.15 集成错误日志聚合 DESCRIPTION:集成Sentry或Rollbar进行错误跟踪。参考2.md Phase 4功能点4。在所有服务中安装sentry-sdk。配置SENTRY_DSN环境变量。在全局异常处理器中集成Sentry。配置错误采样率（100%开发环境，10%生产环境）。配置告警规则。
----[ ] NAME:4.4.16 实现API分页标准化 DESCRIPTION:审查所有列表API端点。参考2.md第四部分4分页。统一分页参数：limit(默认20, 最大100), offset。统一响应格式：{"data": [...], "total": 100, "limit": 20, "offset": 0}。添加Link header支持（next, prev, first, last）。
----[ ] NAME:4.4.17 前端代码分割 DESCRIPTION:实现前端代码分割以提升加载性能。参考2.md Phase 4功能点4。使用React.lazy和Suspense实现路由级别代码分割。使用dynamic import导入大型组件。优化打包配置（Vite splitChunks）。监控bundle大小（目标：首屏<500KB）。
----[ ] NAME:4.4.18 完善API文档 DESCRIPTION:完善所有API端点的OpenAPI文档。参考2.md第四部分1 OpenAPI文档规范。添加详细的描述、参数说明、响应示例。添加请求/响应示例。添加错误码说明。生成静态API文档站点（使用Redoc或Swagger UI）。
----[ ] NAME:4.4.19 完善CI/CD Pipeline DESCRIPTION:创建文件e:\projectBedrock\.github\workflows\ci.yml。参考2.md Phase 4功能点4。CI流程：1)代码检查（black, isort, flake8, mypy, ESLint）。2)单元测试（pytest, Jest）。3)安全扫描（safety, npm audit, Trivy）。4)构建Docker镜像。5)推送到镜像仓库。CD流程：1)部署到测试环境。2)运行集成测试。3)部署到生产环境（需要手动批准）。
----[ ] NAME:4.4.20 编写运维文档 DESCRIPTION:创建文件e:\projectBedrock\docs\OPERATIONS_GUIDE.md。内容包括：1)服务启动/停止/重启流程。2)常见问题排查。3)数据库迁移执行。4)备份/恢复流程。5)监控和告警配置。6)性能调优指南。7)安全事件响应。8)扩容/缩容操作。
----[ ] NAME:4.4.21 全面系统测试 DESCRIPTION:执行全面的系统测试。参考2.md Phase 4功能点4。单元测试：目标覆盖率>80%。集成测试：测试所有服务间交互。端到端测试：测试完整业务流程。压力测试：使用Locust或JMeter测试系统负载能力。安全测试：测试认证、授权、数据加密。生成测试报告。
---[ ] NAME:4.5 低优先级高级功能 DESCRIPTION:参考2.md Phase 4低优先级任务。包括GraphQL支持、交易模拟器Paper Trading。这些是可选的高级功能，可在核心功能完成后实施。
----[ ] NAME:4.5.1 实现GraphQL支持 DESCRIPTION:参考2.md第四部分29 GraphQL支持（可选）。使用Strawberry GraphQL添加GraphQL端点。提供/graphql端点，支持灵活的字段查询。保留REST API作为主要接口，GraphQL作为补充。定义Signal, Position, Trade等类型的GraphQL Schema。实现Query和Mutation。在DecisionEngineService和PortfolioService中添加GraphQL端点。验证：访问/graphql使用GraphQL Playground测试查询。
----[ ] NAME:4.5.2 实现交易模拟器Paper Trading DESCRIPTION:参考2.md第四部分36交易模拟器（Paper Trading）。创建PaperTradingService，实现实时模拟交易。订阅实时价格数据，模拟订单执行。模拟滑点和手续费。记录模拟交易结果，与回测结果对比。提供/v1/paper-trades API端点。前端创建模拟交易页面，显示模拟交易历史和统计。验证：启动模拟交易，观察实时执行和统计。
----[ ] NAME:4.4.22 Phase 4技术债务清理 DESCRIPTION:在Phase 4完成后，进行最终技术债务清理。任务包括：1)安全审计：使用安全扫描工具（Trivy, safety, npm audit）扫描所有依赖，修复高危漏洞。2)性能优化：审查所有API端点的响应时间，优化P95响应时间>2秒的端点。3)数据库优化：审查数据库查询计划，添加缺失的索引，优化慢查询。4)缓存策略优化：审查Redis缓存使用，优化缓存命中率，添加缓存预热机制。5)监控完善：确保所有关键业务指标都有监控和告警（信号生成数、交易数、盈亏、模型准确率）。6)文档完善：审查所有文档，确保与代码实现一致，补充缺失的文档。7)代码质量：运行所有代码质量工具，修复所有警告，确保测试覆盖率>80%。8)备份恢复测试：执行一次完整的备份和恢复演练，验证灾难恢复计划的有效性。创建技术债务清单文件e:\projectBedrock\docs\TECH_DEBT_PHASE4.md。创建最终质量报告e:\projectBedrock\docs\FINAL_QUALITY_REPORT.md，记录所有质量指标（测试覆盖率、性能指标、安全扫描结果、文档完整性）。验证：系统达到生产就绪状态，所有质量指标满足要求。